import{t as Q,a8 as J,a9 as I,aa as K,y as b,ab as X,ac as V,ad as ee,ae as te,af as ae,ag as re,ah as se,ai as ne,h as T,r as j,p as P,j as e,M,T as q,B as E,q as _,L as de,a3 as le,a4 as oe,a6 as ie,a7 as ue}from"./index-7pUSThBQ.js";import{u as me,C as m,a as ce,R as he,G as xe}from"./usePaginationParams-9uAHZ1px.js";import{G as u}from"./Grid-DNfImI8Z.js";import{F as W,I as Y,S as R,a as z,T as g}from"./TextField-CgIwakSO.js";import{D as O}from"./DatePicker-Cl-s-JeO.js";import"./Save-D6agyeYH.js";import"./reselect-BUDjZaXA.js";import"./InputBase-DWvcVoaN.js";import"./useFormControl-Dtka1mg5.js";import"./InputAdornment-wcuKMqBn.js";import"./Checkbox-D95a_-a1.js";import"./SwitchBase-D3X0x81k.js";import"./FormControlLabel-DCxdCMA4.js";import"./KeyboardArrowRight-Dajnyt08.js";import"./TableCell-Cb86HSZf.js";import"./CircularProgress-_EudjK-E.js";try{let r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new r.Error().stack;s&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[s]="7f6b8396-b242-4e05-93e9-badc721817fc",r._sentryDebugIdIdentifier="sentry-dbid-7f6b8396-b242-4e05-93e9-badc721817fc")}catch{}const pe=r=>async s=>{var d,x;try{const h=Q(r);s(J());const c=await I.getStudents(h);s(K(c.data.data))}catch(h){b.error(((x=(d=h.response)==null?void 0:d.data)==null?void 0:x.data)||"Failed to fetch students",{autoClose:3e3})}},fe=r=>async s=>{try{s(se());const d=await I.getStudentById(r);s(ne(d.data.data))}catch(d){b.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},ge=r=>async s=>{try{s(ae());const d=await I.createStudent(r);return s(re(d.data.data)),d.data}catch(d){b.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},je=r=>async s=>{try{s(ee());const d=await I.updateStudent(r,r._id);return s(te(d.data.data)),d.data}catch(d){b.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},Se=r=>async s=>{try{s(X());const d=await I.deleteStudent(r);s(V(r)),b.info(d.message||"Student deleted successfully",{autoClose:3e3})}catch(d){console.log(d),b.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},D={fetchStudents:pe,fetchStudentById:fe,createStudents:ge,updateStudents:je,deleteStudents:Se},be=({initialValues:r,onSubmit:s,onClose:d})=>{var N;const{data:x}=T(t=>t.user),{data:h}=T(t=>t.organization),c=(N=x==null?void 0:x.users)==null?void 0:N.filter(t=>t.role==="STUDENT"),p=h==null?void 0:h.organizations,A={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",enrolledCoursesIds:[],currentClassId:"",dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:C,formState:{errors:n},reset:y}=me({defaultValues:A});j.useEffect(()=>{r&&y({...r,dateOfBirth:r.dateOfBirth?P(r.dateOfBirth):null,createdAt:r.createdAt?P(r.createdAt):null,updatedAt:r.updatedAt?P(r.updatedAt):null})},[r,y]);const v=t=>{const a={...t,dateOfBirth:t.dateOfBirth?t.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:t.createdAt?t.createdAt.format("YYYY-MM-DD"):null,updatedAt:t.updatedAt?t.updatedAt.format("YYYY-MM-DD"):null};s(a)};return e.jsx("form",{onSubmit:C(v),children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:t})=>{var a;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!n.userId,children:[e.jsx(Y,{children:"User ID"}),e.jsx(R,{...t,label:"User ID",renderValue:l=>{var f;return e.jsx(q,{variant:"body2",children:(f=c==null?void 0:c.find(S=>S._id===l))==null?void 0:f.username})},children:c==null?void 0:c.map(l=>e.jsx(M,{value:l._id,children:l.username},l._id))}),e.jsx(z,{children:(a=n.userId)==null?void 0:a.message})]})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"name",control:i,rules:{required:"Name is required"},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Name",fullWidth:!0,margin:"normal",error:!!n.name,helperText:(a=n.name)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!n.phone,helperText:(a=n.phone)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Email",fullWidth:!0,margin:"normal",error:!!n.email,helperText:(a=n.email)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!n.phone,helperText:(a=n.phone)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:t})=>{var a;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!n.organizationId,children:[e.jsx(Y,{children:"Organization"}),e.jsx(R,{...t,label:"Organization",renderValue:l=>e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(f=>{var S;return e.jsx(q,{component:"span",variant:"body2",children:(S=p==null?void 0:p.find(w=>w.id===f))==null?void 0:S.name},f)})}),children:p==null?void 0:p.map(l=>e.jsx(M,{value:l.id,children:l.name},l.id))}),e.jsx(z,{children:(a=n.organizationId)==null?void 0:a.message})]})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"currentClassId",control:i,rules:{required:"Current Class is required"},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Current Class",fullWidth:!0,margin:"normal",error:!!n.currentClassId,helperText:(a=n.currentClassId)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"dateOfBirth",control:i,render:({field:t})=>{var a;return e.jsx(O,{label:"Date of Birth",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!n.dateOfBirth,helperText:(a=n.dateOfBirth)==null?void 0:a.message}}})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"address",control:i,render:({field:{onChange:t,value:a}})=>{var l;return e.jsx(g,{label:"Address",fullWidth:!0,margin:"normal",value:a,onChange:t,error:!!n.address,helperText:(l=n.address)==null?void 0:l.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:i,render:({field:{onChange:t,value:a}})=>{var l;return e.jsx(g,{label:"Email",fullWidth:!0,margin:"normal",value:a,onChange:t,error:!!n.email,helperText:(l=n.email)==null?void 0:l.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"enrollmentDate",control:i,render:({field:t})=>{var a;return e.jsx(O,{label:"Enrollment Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!n.enrollmentDate,helperText:(a=n.enrollmentDate)==null?void 0:a.message}}})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"graduationDate",control:i,render:({field:t})=>{var a;return e.jsx(O,{label:"Graduation Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!n.graduationDate,helperText:(a=n.graduationDate)==null?void 0:a.message}}})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(E,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(_,{variant:"outlined",color:"primary",onClick:()=>{y(A),d()},children:"Cancel"}),e.jsx(_,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function _e(){const r=de(),s=T(o=>o.student.data),d=le(),x=oe().id!==void 0,h=j.useMemo(()=>[{field:"name",headerName:"Student Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"enrolledCoursesIds",headerName:"Enrolled Courses",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"emergencyContacts",headerName:"Emergency Contacts",flex:1,editable:!0,headerClassName:"theme--header"},{field:"graduationDate",headerName:"Graduation Date",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[c,p]=j.useState({}),[A,i]=j.useState(""),[C,n]=j.useState(null),[y,v]=j.useState(!1),{loading:N}=T(o=>o.student),t=j.useCallback(o=>{r(D.fetchStudents(o))},[r]),{params:a,setParams:l}=ce({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},t),f=o=>{l(o)},S=()=>{n(null),i("Add Student"),F()},w=o=>{const $=s==null?void 0:s.students.find(H=>H._id===o);n($||null),i("Edit Student"),F()},G=async o=>{r(D.deleteStudents(o))},U=async o=>{r(C?D.updateStudents({...o,_id:C._id}):D.createStudents(o)),B()},k=()=>{r(D.fetchStudents(a))},F=()=>v(!0),B=()=>v(!1),L=o=>{d(ue.STUDENT_PROFILE.replace(":id",o))},Z=(s==null?void 0:s.totalStudents)||0;return e.jsx(E,{sx:{width:"100%",height:"100%"},children:x?e.jsx(ie,{}):e.jsxs(e.Fragment,{children:[e.jsx(he,{columns:h,onAdd:S,onDelete:G,onEdit:w,rows:(s==null?void 0:s.students)??[],rowModesModel:c,setRowModesModel:p,loading:N,reloadData:k,totalRows:Z,paginationModel:{page:a.page-1,pageSize:a.limit},onParamsChange:o=>f(o),onView:L}),e.jsx(xe,{open:y,onClose:B,title:A,children:e.jsx(be,{initialValues:C,onSubmit:U,onClose:B})})]})})}export{_e as default};
//# sourceMappingURL=Student.page-BvJgngvq.js.map
