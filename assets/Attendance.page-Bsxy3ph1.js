import{p as f,bl as h,bm as i,bn as y,h as o,bo as b,bp as B,bq as P,br as w,bs as x,bt as N,bu as j,bv as V,bw as $,bx as z,by as G,bz as O,bA as _,bB as Q,bC as T,bD as Y,b as H,u as k,r as C,j as S,B as J}from"./index-Iayj6iCM.js";import{u as K,R as L}from"./usePaginationParams-D-EadkPr.js";import"./Edit-CwExJUNw.js";import"./Save-Cbz7BGnc.js";import"./Search-CyrNpi08.js";import"./isHostComponent-Byq13FOA.js";import"./KeyboardArrowRight-B2v7g9ly.js";import"./InputBase-BjWt6y8l.js";import"./Modal-CwWs3I4F.js";import"./MenuItem-B4ZcixFb.js";import"./List-Bn0p357_.js";import"./listItemTextClasses-D33cD7Dv.js";import"./Toolbar-Dy84SFcE.js";import"./TextField-BucTJljM.js";import"./Menu-4fDYuzS_.js";import"./Visibility-CFzAd-gA.js";import"./reselect-chQN1zS_.js";import"./ListItemText-D64mH7rW.js";import"./InputAdornment-B1la7Cdg.js";import"./Checkbox-CqLXZ7o-.js";import"./SwitchBase-eVy0UzNH.js";import"./FormControlLabel-DoYbMEM9.js";import"./LinearProgress-CCvmoNmW.js";import"./CircularProgress-C-K4l3j0.js";const U=c=>async t=>{var a,s,d,n;try{const e=f(c);t(h());const r=await i.getAttendances(e),l={...r.data.data,attendances:m(r.data.data.attendances)};t(y(l))}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to fetch attendances",{autoClose:3e3}),t(b(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to fetch attendances"))}},W=c=>async t=>{var a,s,d,n;try{t(Q());const e=await i.getAttendanceById(c),r={...e.data.data,attendances:m(e.data.data.attendances)};t(T(r))}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to fetch attendance",{autoClose:3e3}),t(Y(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to fetch attendance"))}},X=c=>async t=>{var a,s,d,n;try{t(G());const e=await i.createAttendance(c),r={...e.data.data,attendances:m(e.data.data.attendances)};return t(O(r)),o.success("Attendance created successfully",{autoClose:3e3}),e.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to create attendance",{autoClose:3e3}),t(_(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to create attendance"))}},Z=(c,t)=>async a=>{var s,d,n,e;try{a(V());const r=await i.updateAttendance(c,t),l={...r.data.data,attendances:m(r.data.data.attendances)};return a($(l)),o.success("Attendance updated successfully",{autoClose:3e3}),r.data}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to update attendance",{autoClose:3e3}),a(z(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to update attendance"))}},ee=c=>async t=>{var a,s,d,n;try{t(B()),await i.deleteAttendance(c),t(j(c)),o.success("Attendance deleted successfully",{autoClose:3e3})}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to delete attendance",{autoClose:3e3}),t(P(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to delete attendance"))}},te=(c,t)=>async a=>{var s,d,n,e;try{const r=f(t);a(h());const l=await i.getAttendanceByStudent(c,r),A={...l.data.data,attendances:m(l.data.data.attendances)};a(y(A))}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch student attendance",{autoClose:3e3}),a(b(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to fetch student attendance"))}},ae=(c,t)=>async a=>{var s,d,n,e;try{const r=f(t);a(h());const l=await i.getAttendanceByClass(c,r),A={...l.data.data,attendances:m(l.data.data.attendances)};a(y(A))}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch class attendance",{autoClose:3e3}),a(b(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to fetch class attendance"))}},ne=(c,t)=>async a=>{var s,d,n,e;try{const r=f(t);a(h());const l=await i.getAttendanceByDate(c,r),A={...l.data.data,attendances:m(l.data.data.attendances)};a(y(A))}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch attendance by date",{autoClose:3e3}),a(b(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to fetch attendance by date"))}},se=(c,t)=>async a=>{var s,d;try{const n=f(t);a(h());const e=await i.getStudentAttendanceStats(c,n);return a(y({attendances:[],totalAttendances:0,limit:0,page:0,totalPages:0,serialNumberStartFrom:0,hasPrevPage:!1,hasNextPage:!1,prevPage:null,nextPage:null})),e.data}catch(n){o.error(((d=(s=n.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch student attendance stats",{autoClose:3e3})}},de=(c,t)=>async a=>{var s,d;try{const n=f(t);a(h());const e=await i.getClassAttendanceStats(c,n);return a(y({attendances:[],totalAttendances:0,limit:0,page:0,totalPages:0,serialNumberStartFrom:0,hasPrevPage:!1,hasNextPage:!1,prevPage:null,nextPage:null})),e.data}catch(n){o.error(((d=(s=n.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch class attendance stats",{autoClose:3e3})}},re=c=>async t=>{var a,s,d,n;try{t(w());const e=await i.markBulkAttendance(c),r={...e.data.data,attendances:m(e.data.data.attendances)};return t(x(r)),o.success("Bulk attendance marked successfully",{autoClose:3e3}),e.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to mark bulk attendance",{autoClose:3e3}),t(N(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to mark bulk attendance"))}},ce=c=>async t=>{var a,s,d,n;try{t(w());const e=new FormData;e.append("file",c);const r=await i.createBulkAttendances(e),l={...r.data.data,attendances:m(r.data.data.attendances)};return t(x(l)),o.success("Bulk attendances created successfully",{autoClose:3e3}),r.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to create bulk attendances",{autoClose:3e3}),t(N(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to create bulk attendances"))}},oe=c=>async t=>{var a,s,d,n;try{t(B());const e=await i.deleteBulkAttendances(c),r={...e.data.data,attendances:m(e.data.data.attendances)};return t(y(r)),o.success("Bulk attendances deleted successfully",{autoClose:3e3}),e.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to delete bulk attendances",{autoClose:3e3}),t(P(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to delete bulk attendances"))}},m=c=>c?Array.isArray(c)?c.length>0&&Array.isArray(c[0])?c[0]:c:[c]:[],F={fetchAttendances:U,fetchAttendanceById:W,createAttendance:X,updateAttendance:Z,deleteAttendance:ee,getAttendanceByStudent:te,getAttendanceByClass:ae,getAttendanceByDate:ne,getStudentAttendanceStats:se,getClassAttendanceStats:de,markBulkAttendance:re,createBulkAttendances:ce,deleteBulkAttendances:oe};function qe(){const c=H(),t=k(u=>u.attendance.data),{loading:a}=k(u=>u.attendance),s=C.useMemo(()=>[{field:"classId",headerName:"Class ID",flex:1,editable:!0,headerClassName:"theme--header"},{field:"studentId",headerName:"Student ID",flex:1,editable:!0,headerClassName:"theme--header"},{field:"date",headerName:"Date",flex:1,editable:!0,headerClassName:"theme--header",renderCell:u=>{if(!u.value)return"";const p=new Date(u.value),g=String(p.getDate()).padStart(2,"0"),R=String(p.getMonth()+1).padStart(2,"0"),E=p.getFullYear();return`${g}/${R}/${E}`}},{field:"status",headerName:"Status",flex:1,editable:!0,headerClassName:"theme--header",type:"singleSelect",valueOptions:["present","absent","excused"]},{field:"remarks",headerName:"Remarks",flex:1,editable:!0,headerClassName:"theme--header"},{field:"markedBy",headerName:"Marked By",flex:1,editable:!0,headerClassName:"theme--header"}],[]),[d,n]=C.useState({}),e=C.useCallback(u=>{c(F.fetchAttendances(u))},[c]),{params:r,setParams:l}=K({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},e),A=u=>{l(u)},v=()=>{console.log("Add attendance")},D=u=>{const p=t==null?void 0:t.attendances.find(g=>g._id===u);console.log("Edit attendance:",p)},I=async u=>{c(F.deleteAttendance(u))},M=u=>{const p=t==null?void 0:t.attendances.find(g=>g._id===u);console.log("View attendance:",p)},q=()=>{c(F.fetchAttendances(r))};return S.jsx(J,{sx:{flexGrow:1},children:S.jsx(L,{columns:s,rows:(t==null?void 0:t.attendances)||[],loading:a,onAdd:v,onEdit:D,onView:M,onDelete:I,rowModesModel:d,setRowModesModel:n,totalRows:(t==null?void 0:t.totalAttendances)||0,paginationModel:{page:r.page-1,pageSize:r.limit},onParamsChange:A,reloadData:q})})}export{qe as default};
