import{r as m,o as B,j as r,B as D,p as O,q as G,t as L,A as w,v as k,x as z,y as U,z as Y,C as Z,E as $,F as H,G as J,H as K,I as Q,J as X,K as C}from"./index-SRrTBXCC.js";import{u as V,C as f,a as ee,R as ae,G as te}from"./usePaginationParams-DxAbNu5X.js";import{G as c}from"./Grid-Gh5MVjop.js";import{T as g}from"./TextField-Ck7cFlxI.js";import{D as re}from"./DatePicker-Dnj570HZ.js";import"./useId-CZ066Zps.js";import"./reselect-fumL3tiG.js";import"./Popper-DBdlVSYc.js";import"./Tooltip-CARQlZDD.js";import"./Checkbox-CbKKmzbx.js";import"./FormControlLabel-BJOqXBEo.js";import"./KeyboardArrowRight-BPEmQlsH.js";import"./CircularProgress-MJR8981s.js";import"./Skeleton-D2PZNTa9.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="1368814c-ecb3-47fd-a5b3-3c59e6283812",e._sentryDebugIdIdentifier="sentry-dbid-1368814c-ecb3-47fd-a5b3-3c59e6283812")}catch{}const ie={ADMIN:{organizations:{view:!0,create:!0,update:!0,delete:!0},teachers:{view:!0,create:!0,update:!0,delete:!0},students:{view:!0,create:!0,update:!0,delete:!0},parents:{view:!0,create:!0,update:!0,delete:!0},departments:{view:!0,create:!0,update:!0,delete:!0},classes:{view:!0,create:!0,update:!0,delete:!0},courses:{view:!0,create:!0,update:!0,delete:!0},events:{view:!0,create:!0,update:!0,delete:!0},assignments:{view:!0,create:!0,update:!0,delete:!0},exams:{view:!0,create:!0,update:!0,delete:!0},attendances:{view:!0,create:!0,update:!0,delete:!0},notifications:{view:!0,create:!0,update:!0,delete:!0},settings:{view:!0,create:!0,update:!0,delete:!0}},TEACHER:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:(e,a)=>e.id===a.id,delete:!1},students:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:!1},assignments:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},exams:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},attendances:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},notifications:{view:!0,create:!1,update:!1,delete:!1},settings:{view:!0,create:!0,update:!0,delete:!1}},STUDENT:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:(e,a)=>e.organizationId===a._id,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}},PARENT:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}},ORGADMIN:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}}};function se(e,a,i,l){var n;const o=e.role,u=(n=ie[o][a])==null?void 0:n[i];return u==null?!1:typeof u=="boolean"?u:l!=null&&u(e,l)}const ne=({initialValues:e,onSubmit:a,onClose:i})=>{const l={_id:"",name:"",category:"",number:"",contactEmail:"",contactPhone:"",website:"",logo:"",establishedDate:null,description:""},{control:o,handleSubmit:u,formState:{errors:n},reset:p}=V({defaultValues:l});m.useEffect(()=>{e&&p({...e,establishedDate:e.establishedDate?B(e.establishedDate):null})},[e,p]);const h=s=>{const t={...s,establishedDate:s.establishedDate?s.establishedDate.format("YYYY-MM-DD"):null};a(t)};return r.jsx("form",{onSubmit:u(h),children:r.jsxs(c,{container:!0,spacing:2,children:[r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"name",control:o,rules:{required:"Name is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Name",size:"small",fullWidth:!0,margin:"normal",error:!!n.name,helperText:(t=n.name)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"category",control:o,rules:{required:"Category is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Category",size:"small",fullWidth:!0,margin:"normal",error:!!n.category,helperText:(t=n.category)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"number",control:o,rules:{required:"Number is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Number",size:"small",fullWidth:!0,margin:"normal",error:!!n.number,helperText:(t=n.number)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"contactEmail",control:o,rules:{required:"Contact email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Contact Email",size:"small",fullWidth:!0,margin:"normal",error:!!n.contactEmail,helperText:(t=n.contactEmail)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"contactPhone",control:o,rules:{required:"Contact phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Contact Phone",size:"small",fullWidth:!0,margin:"normal",error:!!n.contactPhone,helperText:(t=n.contactPhone)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"website",control:o,rules:{required:"Website is required",pattern:{value:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,message:"Invalid website URL"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Website",size:"small",fullWidth:!0,margin:"normal",error:!!n.website,helperText:(t=n.website)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"logo",control:o,rules:{required:"Logo URL is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Logo URL",size:"small",fullWidth:!0,margin:"normal",error:!!n.logo,helperText:(t=n.logo)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"establishedDate",control:o,rules:{required:"Established date is required"},render:({field:s})=>{var t;return r.jsx(re,{label:"Established Date",value:s.value,onChange:v=>s.onChange(v),slotProps:{textField:{size:"small",fullWidth:!0,margin:"normal",error:!!n.establishedDate,helperText:(t=n.establishedDate)==null?void 0:t.message}}})}})}),r.jsx(c,{item:!0,xs:12,children:r.jsx(f,{name:"description",control:o,rules:{required:"Description is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,size:"small",label:"Description",fullWidth:!0,multiline:!0,rows:4,margin:"normal",error:!!n.description,helperText:(t=n.description)==null?void 0:t.message})}})}),r.jsx(c,{item:!0,xs:12,children:r.jsxs(D,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[r.jsx(O,{variant:"outlined",color:"primary",onClick:()=>{p(l),i()},children:"Cancel"}),r.jsx(O,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})},oe=e=>async a=>{var i,l;try{const o=G(e);a(L());const u=await w.getOrganizations(o);console.log(u),a(k(u.data.data))}catch(o){z.error(((l=(i=o.response)==null?void 0:i.data)==null?void 0:l.data)||"Failed to fetch organizations",{autoClose:3e3})}},de=e=>async a=>{try{a(K());const i=await w.getOrganizationById(e);a(Q(i.data.data))}catch(i){z.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},le=e=>async a=>{try{a(H());const i=await w.createOrganization(e);return a(J(i.data.data)),i.data}catch(i){z.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ue=e=>async a=>{try{a(Z());const i=await w.updateOrganization(e,e.id);return a($(i.data.data)),i.data}catch(i){z.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ce=e=>async a=>{var i,l;try{a(U());const o=await w.deleteOrganization(e);a(Y(e)),z.info("Organization deleted successfully",{autoClose:3e3})}catch(o){z.error(((l=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:l.data)||"Failed to fetch organization",{autoClose:3e3})}},I={fetchOrganizations:oe,fetchOrganizationById:de,createOrganization:le,updateOrganization:ue,deleteOrganization:ce};function Oe(){const e=X(),a=m.useMemo(()=>[{field:"name",headerName:"Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"category",headerName:"Category",flex:1,editable:!0,headerClassName:"theme--header"},{field:"number",headerName:"Number",flex:1,editable:!0,headerClassName:"theme--header"},{field:"contactEmail",headerName:"Contact Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"contactPhone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"establishedDate",headerName:"Established Date",flex:1,editable:!0,headerClassName:"theme--header"},{field:"description",headerName:"Description",flex:1,editable:!0,headerClassName:"theme--header"}],[]),[i,l]=m.useState({}),[o,u]=m.useState(!1),[n,p]=m.useState(void 0),[h,s]=m.useState(null),{data:t,loading:v}=C(d=>d.organization),x=C(d=>d.auth.user),S=m.useMemo(()=>!x||!(t!=null&&t.organizations)?[]:t.organizations.filter(d=>se(x,"organizations","view",d)),[x,t]),N=m.useCallback(d=>{e(I.fetchOrganizations(d))},[e]),{params:b,setParams:E}=ee({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},N),q=d=>{E(d)},T=()=>{s(null),p("Add Organization"),y()},P=d=>{const j=t==null?void 0:t.organizations.find(W=>W._id===d);console.log("selectedOrganization",j),s(j),p("Edit Organization"),y()},R=async d=>{e(I.deleteOrganization(d))},A=async d=>{e(h?I.updateOrganization({id:h._id,...d}):I.createOrganization(d)),_()},M=()=>{e(I.fetchOrganizations(b))},y=()=>u(!0),_=()=>u(!1),F=(t==null?void 0:t.totalOrganizations)||0;return r.jsxs(D,{sx:{width:"100%",height:"100%"},children:[r.jsx(ae,{columns:a,onAdd:T,onDelete:R,onEdit:P,rows:S??[],rowModesModel:i,setRowModesModel:l,loading:v,reloadData:M,totalRows:F,paginationModel:{page:b.page-1,pageSize:b.limit},onParamsChange:d=>q(d)}),r.jsx(te,{open:o,onClose:_,title:n,children:r.jsx(ne,{initialValues:h,onSubmit:A,onClose:_})})]})}export{Oe as default};
//# sourceMappingURL=Organizations-BQdfHVcJ.js.map
