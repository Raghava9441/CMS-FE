import{r as n,F as K,R as J,U as Z,j as t,G as q,H as E,I as Q,V as ee,W as te,K as oe,X as r,J as L,b as P,u as j,Y as d,Z as ae,$,a0 as T,a1 as re,a2 as W,a3 as se,a4 as D,a5 as ne,a6 as ie,a7 as le,A as H,v as U,y as ce,z,a8 as de,a9 as pe,B as y,aa as ue,ab as me,T as S,ac as xe,ad as V,ae as Y,af as ge,D as M,O as he,ag as fe}from"./index-Iayj6iCM.js";import{a as be}from"./auth.actions-BDLVLHgo.js";import{S as ye}from"./School-BuIYwZqy.js";import{P as ve}from"./Person-CjxiuvXl.js";import{A as ke}from"./Avatar-D9YqVqWk.js";import{M as F}from"./Menu-4fDYuzS_.js";import{M as B}from"./MenuItem-B4ZcixFb.js";import{T as Ce}from"./Toolbar-Dy84SFcE.js";import{L as G,a as we}from"./List-Bn0p357_.js";import{g as Se,l as A,L as je}from"./ListItem-jOw138fS.js";import{L as Ie,a as $e}from"./ListItemText-D64mH7rW.js";import"./Modal-CwWs3I4F.js";import"./isHostComponent-Byq13FOA.js";import"./listItemTextClasses-D33cD7Dv.js";const Re=(e,i)=>{const{ownerState:s}=e;return[i.root,s.dense&&i.dense,s.alignItems==="flex-start"&&i.alignItemsFlexStart,s.divider&&i.divider,!s.disableGutters&&i.gutters]},_e=e=>{const{alignItems:i,classes:s,dense:a,disabled:h,disableGutters:m,divider:x,selected:u}=e,l=Q({root:["root",a&&"dense",!m&&"gutters",x&&"divider",h&&"disabled",i==="flex-start"&&"alignItemsFlexStart",u&&"selected"]},Se,s);return{...s,...l}},Ae=q(ee,{shouldForwardProp:e=>te(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Re})(oe(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${A.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:r(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${A.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:r(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${A.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:r(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:r(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${A.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${A.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:i})=>i.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:i})=>!i.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:i})=>i.dense,style:{paddingTop:4,paddingBottom:4}}]}))),Oe=n.forwardRef(function(i,s){const a=K({props:i,name:"MuiListItemButton"}),{alignItems:h="center",autoFocus:m=!1,component:x="div",children:u,dense:f=!1,disableGutters:l=!1,divider:v=!1,focusVisibleClassName:k,selected:p=!1,className:c,...g}=a,w=n.useContext(G),o=n.useMemo(()=>({dense:f||w.dense||!1,alignItems:h,disableGutters:l}),[h,w.dense,f,l]),C=n.useRef(null);J(()=>{m&&C.current&&C.current.focus()},[m]);const I={...a,alignItems:h,dense:o.dense,disableGutters:l,divider:v,selected:p},_=_e(I),R=Z(C,s);return t.jsx(G.Provider,{value:o,children:t.jsx(Ae,{ref:R,href:g.href||g.to,component:(g.href||g.to)&&x==="div"?"button":x,focusVisibleClassName:E(_.focusVisible,k),ownerState:I,className:E(_.root,c),...g,classes:_,children:u})})}),Le=L(t.jsx("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos"),ze=L(t.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),Be=L(t.jsx("path",{d:"M14.4 6 14 4H5v17h2v-7h5.6l.4 2h7V6z"}),"Flag"),Te=L(t.jsx("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),Me=L(t.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2m6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5z"}),"NotificationsNone"),Ne=()=>{const e=P(),{accessToken:i,user:s}=j(o=>o.auth),{activeConversation:a}=j(o=>o.chat),h=n.useCallback(()=>{console.log("Socket connected successfully"),s!=null&&s._id&&d.emit("user_online",{user_id:s._id}),a!=null&&a._id&&(console.log("Syncing messages for active conversation:",a._id),e(ae(a._id))),e($({severity:"success",message:"Connected to chat server!"}))},[s==null?void 0:s._id,a==null?void 0:a._id,e]),m=n.useCallback(o=>{console.log("Received initial connection response from server:",o)},[e]),x=n.useCallback(o=>{console.error("Socket connection error:",o),e($({severity:"error",message:`Connection failed: ${o.message}`}))},[e]),u=n.useCallback(o=>{console.error("Socket error:",o),e($({severity:o.status==="error"?"error":"warning",message:`Server Error (${o.code||"UNKNOWN"}): ${o.message}${o.errorId?` (ID: ${o.errorId})`:""}`}))},[e]),f=n.useCallback(o=>{var C,I;console.log("ðŸ“¨ New message received:",o),e(T(o)),((C=o.sender)==null?void 0:C._id)!==(s==null?void 0:s._id)&&e($({severity:"info",message:`New message from ${((I=o.sender)==null?void 0:I.firstName)||"Someone"}`}))},[s==null?void 0:s._id,e]),l=n.useCallback(o=>{console.error("âŒ Message error:",o),e($({severity:"error",message:`Failed to send message: ${o.message||o.error||"Unknown error"}`}))},[e]),v=n.useCallback(o=>{console.log("ðŸ‘¥ Online friends update:",o),e(re(o))},[e]),k=n.useCallback(o=>{console.log("âœï¸ User started typing:",o),e(W({...o,isTyping:!0}))},[e]),p=n.useCallback(o=>{console.log("âœï¸ User stopped typing:",o),e(W({...o,isTyping:!1}))},[e]),c=n.useCallback(o=>{console.log("ðŸ”„ Syncing messages:",o),Array.isArray(o)?o.forEach(C=>e(T(C))):o&&e(T(o)),e($({severity:"info",message:`Synced ${Array.isArray(o)?o.length:1} new message(s).`}))},[e]),g=n.useCallback(()=>{console.warn("ðŸš¨ Server is shutting down!"),e($({severity:"warning",message:"Chat server is shutting down. You may be disconnected."}))},[e]),w=n.useCallback(o=>{console.log("ðŸ“¤ Received updated permissions from server:",o),e(se(o))},[e]);return n.useEffect(()=>{if(e(D({isOptimistic:!0})),i&&(!d||!d.connected)&&(console.log("Attempting to connect socket..."),ne(i)),d)return d.on("connect",h),d.on("connection_established",m),d.on("connect_error",x),d.on("error",u),d.on("message_received",f),d.on("message_error",l),d.on("online_friends",v),d.on("start_typing",k),d.on("stop_typing",p),d.on("message_sync",c),d.on("server_shutdown",g),d.on("permissions_updated",w),()=>{console.log("Cleaning up socket listeners..."),d.off("connect",h),d.off("connection_established",m),d.off("connect_error",x),d.off("error",u),d.off("message_received",f),d.off("message_error",l),d.off("online_friends",v),d.off("start_typing",k),d.off("stop_typing",p),d.off("message_sync",c),d.off("server_shutdown",g)}},[i,e,s==null?void 0:s._id,a==null?void 0:a._id,h,m,x,u,f,l,v,k,p,c,g]),{}},Ee=(e,i)=>{const s=[],a=m=>{if(!m)return!0;const x=i.find(u=>u.name===m);return x?x.view:!1},h=m=>{var x,u,f;for(const l of m){const v=!((x=l.permission)!=null&&x.roles)||l.permission.roles.includes(e),k=a(l.resourceName||""),p=!0;(u=l.permission)!=null&&u.customCheck;const c=v&&k&&p;l.showInSidebar&&c&&s.push({id:l.id,path:l.path,label:(f=l.metadata)!=null&&f.title?l.metadata.title:l.id,metadata:l.metadata,resourceName:l.resourceName}),l.children&&h(l.children)}};return h(ie),s},We=260,Fe=80,O={layoutWrapper:{display:"flex",height:"100vh",flexFlow:"row nowrap",position:"relative",backgroundColor:e=>r(e.palette.background.default,.95)},layoutContainer:{height:"100%",width:"-webkit-fill-available",flexGrow:1,minWidth:0,display:"flex",flexDirection:"column"},layoutHeader:e=>({width:"100%",minHeight:"80px",paddingX:4,paddingY:1,background:`linear-gradient(135deg, ${r(e.palette.background.paper,.9)} 0%, ${r(e.palette.background.paper,.95)} 100%)`,backdropFilter:"blur(20px)",borderBottom:`1px solid ${r(e.palette.divider,.1)}`,boxShadow:`0 4px 20px ${r(e.palette.common.black,.05)}`,zIndex:1}),headerRow:{display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%"},pageWrapper:e=>({flexGrow:1,padding:1.5,backgroundColor:e.palette.background.default,overflow:"auto","&::-webkit-scrollbar":{width:"8px",height:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:r(e.palette.divider,.05)},"&::-webkit-scrollbar-thumb":{backgroundColor:r(e.palette.primary.main,.3),borderRadius:"4px","&:hover":{backgroundColor:r(e.palette.primary.main,.5)}}})},Ge=me.memo(({location:e,collapsed:i,handleDrawerCollapse:s})=>{const a=H(),h=U(),m=j(p=>p.auth.user),x=j(p=>p.auth.permissions),[u,f]=n.useState(1),l=n.useMemo(()=>Ee(m==null?void 0:m.role,x),[m==null?void 0:m.role,x]),v=()=>{setTimeout(()=>{var p;f(c=>c===1?2:1),(p=document.getElementById("layout-container"))==null||p.removeAttribute("style")},150)},k=n.useCallback(p=>{h(p)},[h]);return t.jsxs(y,{sx:{width:u===2?Fe:We,height:"100%",position:"relative",background:`linear-gradient(180deg, ${r(a.palette.background.paper,.98)} 0%, ${r(a.palette.background.paper,.95)} 100%)`,backdropFilter:"blur(20px)",borderRight:`1px solid ${r(a.palette.divider,.1)}`,boxShadow:`4px 0 20px ${r(a.palette.common.black,.08)}`,transition:"width 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",flexDirection:"column",zIndex:10},children:[t.jsxs(Ce,{sx:{display:"flex",alignItems:"center",justifyContent:u===2?"center":"flex-start",px:3,py:2.5,gap:2},children:[t.jsx(y,{sx:{width:48,height:48,borderRadius:"12px",background:`linear-gradient(135deg, ${a.palette.primary.main} 0%, ${a.palette.primary.dark} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 4px 12px ${r(a.palette.primary.main,.3)}`},children:t.jsx(ye,{sx:{fontSize:28,color:"white"}})}),u!==2&&t.jsx(S,{variant:"h6",sx:{color:a.palette.primary.main,fontWeight:700,whiteSpace:"nowrap",letterSpacing:"-0.5px"},children:"Scholar Sync"})]}),t.jsx(M,{sx:{borderColor:r(a.palette.divider,.1)}}),t.jsx(we,{sx:{flexGrow:1,gap:.5,overflow:"auto",display:"flex",flexDirection:"column",px:2,py:2,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:r(a.palette.primary.main,.2),borderRadius:"3px"}},children:l.map(p=>{var w;const c=(w=p.metadata)==null?void 0:w.icon,g=e===p.path;return t.jsx(je,{disablePadding:!0,sx:{mb:.5},children:t.jsx(V,{title:u===2?p.label:"",placement:"right",arrow:!0,disableHoverListener:u!==2,children:t.jsxs(Oe,{onClick:()=>k(p.path),sx:{minHeight:48,borderRadius:"12px",px:2,justifyContent:u===2?"center":"flex-start",backgroundColor:g?r(a.palette.primary.main,.12):"transparent",position:"relative",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&::before":g?{content:'""',position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:"4px",height:"60%",backgroundColor:a.palette.primary.main,borderRadius:"0 4px 4px 0"}:{},"&:hover":{backgroundColor:g?r(a.palette.primary.main,.15):r(a.palette.action.hover,.8),transform:"translateX(4px)"}},children:[t.jsx(Ie,{sx:{minWidth:0,mr:u===2?0:2.5,justifyContent:"center",color:g?a.palette.primary.main:a.palette.text.secondary},children:c&&t.jsx(c,{fontSize:"medium"})}),u!==2&&t.jsx($e,{primary:p.label,primaryTypographyProps:{fontWeight:g?600:500,fontSize:"0.9rem",color:g?a.palette.primary.main:a.palette.text.primary}})]})})},p.id)})}),t.jsx(y,{sx:{p:2,borderTop:`1px solid ${r(a.palette.divider,.1)}`},children:t.jsx(Y,{onClick:v,sx:{width:"100%",height:44,borderRadius:"12px",backgroundColor:r(a.palette.primary.main,.08),transition:"all 0.3s ease","&:hover":{backgroundColor:r(a.palette.primary.main,.15),transform:"scale(1.02)"}},children:u===2?t.jsx(ze,{sx:{fontSize:18,color:a.palette.primary.main}}):t.jsx(Le,{sx:{fontSize:18,color:a.palette.primary.main}})})})]})});function ot(){var N;le(),Ne();const e=H(),i=P(),s=U(),a=ce(),[h,m]=n.useState(!1),[x,u]=n.useState(null),[f,l]=n.useState(null),v=!!x,k=!!f,p=j(b=>b.auth.isAuthenticated),c=j(b=>b.auth.user),g=j(b=>b.auth.accessToken),w=j(b=>b.chat.activeConversation);n.useEffect(()=>{i(D({isOptimistic:!0}))},[i,g,c==null?void 0:c._id,w]),n.useEffect(()=>{p?(i(de()),i(pe())):s(z.LOGIN)},[p,i]);const o=n.useCallback(()=>{m(b=>!b)},[]),C=n.useCallback(b=>{u(b.currentTarget)},[]),I=n.useCallback(b=>{l(b.currentTarget)},[]),_=n.useCallback(()=>{l(null)},[]),R=n.useCallback(()=>{u(null)},[]),X=n.useCallback(()=>{i(be.logoutUser(s))},[i,s]);return t.jsxs(y,{sx:O.layoutWrapper,children:[t.jsx(ue,{}),t.jsx(Ge,{location:a.pathname,collapsed:h,handleDrawerCollapse:o}),t.jsxs(y,{id:"layout-container",sx:O.layoutContainer,children:[t.jsx(y,{sx:O.layoutHeader,children:t.jsxs(y,{sx:O.headerRow,children:[t.jsxs(y,{children:[t.jsxs(S,{variant:"h5",sx:{fontWeight:700,background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${e.palette.primary.dark} 100%)`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",mb:.5},children:["Welcome back, ",(c==null?void 0:c.fullname)||"Guest"]}),t.jsx(S,{variant:"body2",color:"text.secondary",fontWeight:500,children:"Manage and monitor teacher performance and profiles"})]}),t.jsxs(xe,{direction:"row",spacing:1.5,alignItems:"center",children:[t.jsx(V,{title:"Notifications",arrow:!0,children:t.jsx(Y,{onClick:I,sx:{width:44,height:44,borderRadius:"12px",backgroundColor:r(e.palette.background.paper,.8),border:`1px solid ${r(e.palette.divider,.1)}`,transition:"all 0.3s ease","&:hover":{backgroundColor:e.palette.background.paper,borderColor:e.palette.primary.main,transform:"translateY(-2px)",boxShadow:`0 4px 12px ${r(e.palette.primary.main,.2)}`}},children:t.jsx(ge,{variant:"dot",color:"error",sx:{"& .MuiBadge-badge":{top:4,right:4}},children:t.jsx(Me,{fontSize:"small"})})})}),t.jsx(M,{orientation:"vertical",flexItem:!0,sx:{my:1}}),t.jsxs(y,{onClick:C,sx:{display:"flex",alignItems:"center",gap:1.5,padding:"6px 12px 6px 6px",borderRadius:"12px",backgroundColor:r(e.palette.background.paper,.8),border:`1px solid ${r(e.palette.divider,.1)}`,cursor:"pointer",transition:"all 0.3s ease","&:hover":{backgroundColor:e.palette.background.paper,borderColor:e.palette.primary.main,transform:"translateY(-2px)",boxShadow:`0 4px 12px ${r(e.palette.primary.main,.2)}`}},children:[t.jsx(ke,{sx:{width:36,height:36,background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${e.palette.primary.dark} 100%)`,fontSize:14,fontWeight:600,boxShadow:`0 2px 8px ${r(e.palette.primary.main,.3)}`},children:((N=c==null?void 0:c.fullname)==null?void 0:N.charAt(0))||"G"}),t.jsxs(y,{sx:{display:{xs:"none",sm:"block"}},children:[t.jsx(S,{variant:"body2",fontWeight:600,lineHeight:1.2,children:(c==null?void 0:c.fullname)||"Guest User"}),t.jsx(S,{variant:"caption",color:"text.secondary",children:(c==null?void 0:c.role)||"User"})]})]})]})]})}),t.jsx(y,{component:"main",sx:O.pageWrapper,children:t.jsx(he,{})})]}),t.jsxs(F,{anchorEl:x,open:v,onClose:R,PaperProps:{sx:{minWidth:220,mt:1,borderRadius:"12px",boxShadow:`0 8px 32px ${r(e.palette.common.black,.12)}`,border:`1px solid ${r(e.palette.divider,.1)}`,"& .MuiMenuItem-root":{borderRadius:"8px",mx:1,my:.5,px:2,gap:1.5,fontSize:"0.9rem",transition:"all 0.2s ease","&:hover":{backgroundColor:r(e.palette.primary.main,.08)}}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[t.jsxs(B,{onClick:()=>{R(),s(z.PROFILE)},children:[t.jsx(ve,{fontSize:"small",color:"primary"}),"Profile"]}),t.jsxs(B,{onClick:()=>{R(),s(z.SETTINGS)},children:[t.jsx(fe,{fontSize:"small",color:"primary"}),"Settings"]}),t.jsxs(B,{onClick:()=>{R(),s(z.FEATURE_FLAGS)},children:[t.jsx(Be,{fontSize:"small",color:"primary"}),"Feature Control"]}),t.jsx(M,{sx:{my:.5}}),t.jsxs(B,{onClick:X,children:[t.jsx(Te,{fontSize:"small",color:"error"}),t.jsx(S,{color:"error.main",children:"Logout"})]})]}),t.jsxs(F,{anchorEl:f,open:k,onClose:_,PaperProps:{sx:{minWidth:320,maxWidth:400,mt:1,borderRadius:"12px",boxShadow:`0 8px 32px ${r(e.palette.common.black,.12)}`,border:`1px solid ${r(e.palette.divider,.1)}`}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[t.jsx(y,{sx:{p:2,borderBottom:`1px solid ${r(e.palette.divider,.1)}`},children:t.jsx(S,{variant:"h6",fontWeight:600,children:"Notifications"})}),t.jsx(y,{sx:{p:2},children:t.jsx(S,{variant:"body2",color:"text.secondary",textAlign:"center",children:"No new notifications"})})]})]})}export{ot as default};
