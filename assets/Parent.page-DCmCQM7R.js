import{p as $,ak as L,al as S,am as H,v as b,an as J,ao as Q,ap as K,aq as X,ar as V,as as ee,at as ae,au as re,h as v,r as g,L as O,j as e,M as z,T as E,B as w,N as q,J as te}from"./index-DgQHWWw6.js";import{u as se,R as ne}from"./usePaginationParams-DwnLzO8u.js";import oe from"./GenericModal-DF_-oMZU.js";import{u as le,C as c}from"./index.esm-QTyF_s8d.js";import{G as m}from"./Grid-CdZ8gNQp.js";import{F as W,I as Y,S as R,a as _,T as y}from"./TextField-Bpx2TdiV.js";import{D as M}from"./DatePicker-lc64QBH_.js";import"./Save-Dx3sa6bc.js";import"./reselect-CSPtcQt5.js";import"./InputBase-6s9B2OtX.js";import"./useFormControl-cjLqdzgI.js";import"./InputAdornment-BcV2iJv_.js";import"./Checkbox-B9rZYL3U.js";import"./SwitchBase-BiStZX0Z.js";import"./FormControlLabel-BL9PB2Z2.js";import"./KeyboardArrowRight-DGxqdYri.js";import"./TableCell-C9jJLafw.js";import"./CircularProgress-D4KD0uhr.js";import"./Person-DAqrzjRN.js";import"./DialogContent-Cj2U3tyN.js";const de=t=>async s=>{var n,x;try{const h=$(t);s(L());const u=await S.getParents(h);s(H(u.data.data))}catch(h){b.error(((x=(n=h.response)==null?void 0:n.data)==null?void 0:x.data)||"Failed to fetch organizations",{autoClose:3e3})}},ie=t=>async s=>{try{s(ae());const n=await S.getParentById(t);s(re(n.data.data))}catch(n){b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},me=t=>async s=>{try{s(V());const n=await S.createParent(t);return s(ee(n.data.data)),n.data}catch(n){b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ce=t=>async s=>{try{if(s(K()),t._id){const n=await S.updateParent(t,t._id);return s(X(n.data.data)),n.data}else throw new Error("Teacher ID is required for update")}catch(n){n instanceof Error&&b.error(n.message||"Failed to fetch organization",{autoClose:3e3})}},ue=t=>async s=>{try{s(J());const n=await S.deleteParent(t);s(Q(t)),b.info(n.message||"Organization deleted successfully",{autoClose:3e3})}catch(n){console.log(n),b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},A={fetchParents:de,fetchParentById:ie,createParents:me,updateParents:ce,deleteParents:ue},he=({initialValues:t,onSubmit:s,onClose:n})=>{var P;const{data:x}=v(a=>a.user),{data:h}=v(a=>a.organization),u=(P=x==null?void 0:x.users)==null?void 0:P.filter(a=>a.role==="PARENT"),p=h==null?void 0:h.organizations,j={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",childrenIds:[],dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:I,formState:{errors:o},reset:D}=le({defaultValues:j});g.useEffect(()=>{t&&D({...t,dateOfBirth:t.dateOfBirth?O(t.dateOfBirth):null,createdAt:t.createdAt?O(t.createdAt):null,updatedAt:t.updatedAt?O(t.updatedAt):null})},[t,D]);const N=a=>{const r={...a,dateOfBirth:a.dateOfBirth?a.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:a.createdAt?a.createdAt.format("YYYY-MM-DD"):null,updatedAt:a.updatedAt?a.updatedAt.format("YYYY-MM-DD"):null};s(r)};return e.jsx("form",{onSubmit:I(N),children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:a})=>{var r;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!o.userId,children:[e.jsx(Y,{children:"User ID"}),e.jsx(R,{...a,label:"User ID",renderValue:l=>{var f;return e.jsx(E,{variant:"body2",children:(f=u==null?void 0:u.find(C=>C._id===l))==null?void 0:f.username})},children:u==null?void 0:u.map(l=>e.jsx(z,{value:l._id,children:l.username},l._id))}),e.jsx(_,{children:(r=o.userId)==null?void 0:r.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"name",control:i,rules:{required:"Name is required"},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Name",fullWidth:!0,margin:"normal",error:!!o.name,helperText:(r=o.name)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!o.phone,helperText:(r=o.phone)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Email",fullWidth:!0,margin:"normal",error:!!o.email,helperText:(r=o.email)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!o.phone,helperText:(r=o.phone)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:a})=>{var r;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!o.organizationId,children:[e.jsx(Y,{children:"Organization"}),e.jsx(R,{...a,label:"Organization",renderValue:l=>e.jsx(w,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(f=>{var C;return e.jsx(E,{component:"span",variant:"body2",children:(C=p==null?void 0:p.find(B=>B.id===f))==null?void 0:C.name},f)})}),children:p==null?void 0:p.map(l=>e.jsx(z,{value:l.id,children:l.name},l.id))}),e.jsx(_,{children:(r=o.organizationId)==null?void 0:r.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"dateOfBirth",control:i,render:({field:a})=>{var r;return e.jsx(M,{label:"Date of Birth",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!o.dateOfBirth,helperText:(r=o.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"address",control:i,render:({field:{onChange:a,value:r}})=>{var l;return e.jsx(y,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!o.address,helperText:(l=o.address)==null?void 0:l.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,render:({field:{onChange:a,value:r}})=>{var l;return e.jsx(y,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!o.email,helperText:(l=o.email)==null?void 0:l.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"enrollmentDate",control:i,render:({field:a})=>{var r;return e.jsx(M,{label:"Enrollment Date",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!o.enrollmentDate,helperText:(r=o.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"graduationDate",control:i,render:({field:a})=>{var r;return e.jsx(M,{label:"Graduation Date",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!o.graduationDate,helperText:(r=o.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(q,{variant:"outlined",color:"primary",onClick:()=>{D(j),n()},children:"Cancel"}),e.jsx(q,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function Fe(){const t=te(),s=v(d=>d.parent.data),n=g.useMemo(()=>[{field:"name",headerName:"Parent Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"occupation",headerName:"Occupation",flex:1,editable:!0,headerClassName:"theme--header"},{field:"relationshipToStudent",headerName:"Relationship to Student",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[x,h]=g.useState({}),[u,p]=g.useState(""),[j,i]=g.useState(null),[I,o]=g.useState(!1),{loading:D}=v(d=>d.parent),N=g.useCallback(d=>{t(A.fetchParents(d))},[t]),{params:P,setParams:a}=se({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},N),r=d=>{a(d)},l=()=>{i(null),p("Add Parent"),F()},f=d=>{const U=s==null?void 0:s.parents.find(Z=>Z._id===d);i(U||null),p("Edit Parent"),F()},C=async d=>{t(A.deleteParents(d))},B=async d=>{t(j?A.updateParents({...d,_id:j._id}):A.createParents(d)),T()},k=()=>{t(A.fetchParents(P))},F=()=>o(!0),T=()=>o(!1),G=(s==null?void 0:s.totalParents)||0;return e.jsxs(w,{sx:{width:"100%",height:"100%"},children:[e.jsx(ne,{columns:n,onAdd:l,onDelete:C,onEdit:f,rows:(s==null?void 0:s.parents)??[],rowModesModel:x,setRowModesModel:h,loading:D,reloadData:k,totalRows:G,paginationModel:{page:P.page-1,pageSize:P.limit},onParamsChange:d=>r(d)}),e.jsx(oe,{open:I,onClose:T,title:u,children:e.jsx(he,{initialValues:j,onSubmit:B,onClose:T})})]})}export{Fe as default};
//# sourceMappingURL=Parent.page-DCmCQM7R.js.map
