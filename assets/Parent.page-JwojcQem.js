import{a3 as R,a4 as A,a5 as G,c as b,a6 as U,a7 as Z,a8 as $,a9 as k,aa as H,ab as L,ac as J,ad as K,o as I,r as j,d as B,j as e,M as E,T as F,B as O,a as M,n as Q}from"./index-6uvYCzAv.js";import{u as X,C as c,R as V,G as ee}from"./ReusableDataGrid-DIa8TJN9.js";import{G as i}from"./Grid-B9qvS3_0.js";import{F as w,I as z,S as W,a as Y,T as P}from"./TextField-Bv3E0Oob.js";import{D as T}from"./DatePicker-DxP20c8X.js";import"./useId-DYa6g2gg.js";import"./Tooltip-BEzk5LJS.js";import"./Checkbox-Dc87oLfZ.js";import"./FormControlLabel-D3dGLT1d.js";import"./KeyboardArrowRight-Bil8_ghF.js";import"./CircularProgress-Z3M4Fom8.js";import"./Skeleton-BlEGkBbT.js";const ae=()=>async t=>{var l,n;try{t(R());const u=await A.getParents();t(G(u.data.data))}catch(u){b.error(((n=(l=u.response)==null?void 0:l.data)==null?void 0:n.data)||"Failed to fetch organizations",{autoClose:3e3})}},re=t=>async l=>{try{l(J());const n=await A.getParentById(t);l(K(n.data.data))}catch(n){b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},te=t=>async l=>{try{l(H());const n=await A.createParent(t);return l(L(n.data.data)),n.data}catch(n){b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ne=t=>async l=>{try{if(l($()),t._id){const n=await A.updateParent(t,t._id);return l(k(n.data.data)),n.data}else throw new Error("Teacher ID is required for update")}catch(n){n instanceof Error&&b.error(n.message||"Failed to fetch organization",{autoClose:3e3})}},se=t=>async l=>{try{l(U());const n=await A.deleteParent(t);l(Z(t)),b.info(n.message||"Organization deleted successfully",{autoClose:3e3})}catch(n){console.log(n),b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},D={fetchParents:ae,fetchParentById:re,createParents:te,updateParents:ne,deleteParents:se},de=({initialValues:t,onSubmit:l,onClose:n})=>{var S;const{data:u}=I(a=>a.user),{data:y}=I(a=>a.organization),x=(S=u==null?void 0:u.users)==null?void 0:S.filter(a=>a.role==="PARENT"),h=y==null?void 0:y.organizations,g={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",childrenIds:[],dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:o,handleSubmit:N,formState:{errors:s},reset:C}=X({defaultValues:g});j.useEffect(()=>{t&&C({...t,dateOfBirth:t.dateOfBirth?B(t.dateOfBirth):null,createdAt:t.createdAt?B(t.createdAt):null,updatedAt:t.updatedAt?B(t.updatedAt):null})},[t,C]);const v=a=>{const r={...a,dateOfBirth:a.dateOfBirth?a.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:a.createdAt?a.createdAt.format("YYYY-MM-DD"):null,updatedAt:a.updatedAt?a.updatedAt.format("YYYY-MM-DD"):null};l(r)};return e.jsx("form",{onSubmit:N(v),children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"userId",control:o,rules:{required:"User ID is required"},render:({field:a})=>{var r;return e.jsxs(w,{fullWidth:!0,margin:"normal",error:!!s.userId,children:[e.jsx(z,{children:"User ID"}),e.jsx(W,{...a,label:"User ID",renderValue:d=>{var p;return e.jsx(F,{variant:"body2",children:(p=x==null?void 0:x.find(f=>f._id===d))==null?void 0:p.username})},children:x==null?void 0:x.map(d=>e.jsx(E,{value:d._id,children:d.username},d._id))}),e.jsx(Y,{children:(r=s.userId)==null?void 0:r.message})]})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"name",control:o,rules:{required:"Name is required"},render:({field:a})=>{var r;return e.jsx(P,{...a,label:"Name",fullWidth:!0,margin:"normal",error:!!s.name,helperText:(r=s.name)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:o,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(P,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!s.phone,helperText:(r=s.phone)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:o,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:a})=>{var r;return e.jsx(P,{...a,label:"Email",fullWidth:!0,margin:"normal",error:!!s.email,helperText:(r=s.email)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:o,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(P,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!s.phone,helperText:(r=s.phone)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"organizationId",control:o,rules:{required:"Organization is required"},render:({field:a})=>{var r;return e.jsxs(w,{fullWidth:!0,margin:"normal",error:!!s.organizationId,children:[e.jsx(z,{children:"Organization"}),e.jsx(W,{...a,label:"Organization",renderValue:d=>e.jsx(O,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.map(p=>{var f;return e.jsx(F,{component:"span",variant:"body2",children:(f=h==null?void 0:h.find(m=>m.id===p))==null?void 0:f.name},p)})}),children:h==null?void 0:h.map(d=>e.jsx(E,{value:d.id,children:d.name},d.id))}),e.jsx(Y,{children:(r=s.organizationId)==null?void 0:r.message})]})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"dateOfBirth",control:o,render:({field:a})=>{var r;return e.jsx(T,{label:"Date of Birth",value:a.value,onChange:d=>a.onChange(d),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.dateOfBirth,helperText:(r=s.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"address",control:o,render:({field:{onChange:a,value:r}})=>{var d;return e.jsx(P,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!s.address,helperText:(d=s.address)==null?void 0:d.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:o,render:({field:{onChange:a,value:r}})=>{var d;return e.jsx(P,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!s.email,helperText:(d=s.email)==null?void 0:d.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"enrollmentDate",control:o,render:({field:a})=>{var r;return e.jsx(T,{label:"Enrollment Date",value:a.value,onChange:d=>a.onChange(d),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.enrollmentDate,helperText:(r=s.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"graduationDate",control:o,render:({field:a})=>{var r;return e.jsx(T,{label:"Graduation Date",value:a.value,onChange:d=>a.onChange(d),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.graduationDate,helperText:(r=s.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(O,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(M,{variant:"outlined",color:"primary",onClick:()=>{C(g),n()},children:"Cancel"}),e.jsx(M,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function Pe(){const t=Q(),l=I(m=>m.parent.data),n=j.useMemo(()=>[{field:"name",headerName:"Parent Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"occupation",headerName:"Occupation",flex:1,editable:!0,headerClassName:"theme--header"},{field:"relationshipToStudent",headerName:"Relationship to Student",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[u,y]=j.useState({}),[x,h]=j.useState(""),[g,o]=j.useState(null),[N,s]=j.useState(!1),{loading:C}=I(m=>m.parent);j.useEffect(()=>{t(D.fetchParents())},[t]);const v=()=>{o(null),h("Add Parent"),p()},S=m=>{const q=l==null?void 0:l.parents.find(_=>_._id===m);o(q||null),h("Edit Parent"),p()},a=async m=>{t(D.deleteParents(m))},r=async m=>{t(g?D.updateParents({...m,_id:g._id}):D.createParents(m)),f()},d=()=>{t(D.fetchParents())},p=()=>s(!0),f=()=>s(!1);return e.jsxs(O,{sx:{width:"100%",height:"100%"},children:[e.jsx(V,{columns:n,onAdd:v,onDelete:a,onEdit:S,rows:(l==null?void 0:l.parents)??[],rowModesModel:u,setRowModesModel:y,loading:C,reloadData:d}),e.jsx(ee,{open:N,onClose:f,title:x,children:e.jsx(de,{initialValues:g,onSubmit:r,onClose:f})})]})}export{Pe as default};
