import{a5 as G,a6 as I,a7 as R,v as b,a8 as U,a9 as k,aa as Z,ab as $,ac as H,ad as J,ae as L,af as K,J as N,r as j,o as B,j as e,O,T as F,B as E,p as M,I as Q}from"./index-Wd-8jL93.js";import{u as X,C as m,R as V,G as ee}from"./ReusableDataGrid-PkJBO54C.js";import{G as i}from"./Grid-BItJlU2y.js";import{F as W,I as _,S as q,a as Y,T as g}from"./TextField-DVS9y7A2.js";import{D as w}from"./DatePicker-CPBgzmSV.js";import"./useId-f-0gxjm5.js";import"./reselect-BvQ8g9LW.js";import"./Popper-CDsUKxV4.js";import"./Tooltip-CQiT63pF.js";import"./Checkbox-C_gto7pG.js";import"./FormControlLabel-CRMT0ule.js";import"./KeyboardArrowRight-Jv_56AXw.js";import"./CircularProgress-2j3MWkQb.js";import"./Skeleton-BR34Hr5U.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},d=new a.Error().stack;d&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[d]="7848d9df-c07f-46ac-b1be-7f8e038fc704",a._sentryDebugIdIdentifier="sentry-dbid-7848d9df-c07f-46ac-b1be-7f8e038fc704")}catch{}const te=()=>async a=>{var d,n;try{a(G());const c=await I.getStudents();a(R(c.data.data))}catch(c){b.error(((n=(d=c.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to fetch students",{autoClose:3e3})}},re=a=>async d=>{try{d(L());const n=await I.getStudentById(a);d(K(n.data.data))}catch(n){b.error(n.response.data.data||"Failed to fetch student",{autoClose:3e3})}},ae=a=>async d=>{try{d(H());const n=await I.createStudent(a);return d(J(n.data.data)),n.data}catch(n){b.error(n.response.data.data||"Failed to fetch student",{autoClose:3e3})}},se=a=>async d=>{try{d(Z());const n=await I.updateStudent(a,a._id);return d($(n.data.data)),n.data}catch(n){b.error(n.response.data.data||"Failed to fetch student",{autoClose:3e3})}},de=a=>async d=>{try{d(U());const n=await I.deleteStudent(a);d(k(a)),b.info(n.message||"Student deleted successfully",{autoClose:3e3})}catch(n){console.log(n),b.error(n.response.data.data||"Failed to fetch student",{autoClose:3e3})}},D={fetchStudents:te,fetchStudentById:re,createStudents:ae,updateStudents:se,deleteStudents:de},ne=({initialValues:a,onSubmit:d,onClose:n})=>{var A;const{data:c}=N(t=>t.user),{data:C}=N(t=>t.organization),f=(A=c==null?void 0:c.users)==null?void 0:A.filter(t=>t.role==="STUDENT"),h=C==null?void 0:C.organizations,S={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",enrolledCoursesIds:[],currentClassId:"",dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:o,handleSubmit:T,formState:{errors:s},reset:y}=X({defaultValues:S});j.useEffect(()=>{a&&y({...a,dateOfBirth:a.dateOfBirth?B(a.dateOfBirth):null,createdAt:a.createdAt?B(a.createdAt):null,updatedAt:a.updatedAt?B(a.updatedAt):null})},[a,y]);const v=t=>{const r={...t,dateOfBirth:t.dateOfBirth?t.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:t.createdAt?t.createdAt.format("YYYY-MM-DD"):null,updatedAt:t.updatedAt?t.updatedAt.format("YYYY-MM-DD"):null};d(r)};return e.jsx("form",{onSubmit:T(v),children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"userId",control:o,rules:{required:"User ID is required"},render:({field:t})=>{var r;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!s.userId,children:[e.jsx(_,{children:"User ID"}),e.jsx(q,{...t,label:"User ID",renderValue:l=>{var x;return e.jsx(F,{variant:"body2",children:(x=f==null?void 0:f.find(p=>p._id===l))==null?void 0:x.username})},children:f==null?void 0:f.map(l=>e.jsx(O,{value:l._id,children:l.username},l._id))}),e.jsx(Y,{children:(r=s.userId)==null?void 0:r.message})]})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"name",control:o,rules:{required:"Name is required"},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Name",fullWidth:!0,margin:"normal",error:!!s.name,helperText:(r=s.name)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:o,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!s.phone,helperText:(r=s.phone)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:o,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Email",fullWidth:!0,margin:"normal",error:!!s.email,helperText:(r=s.email)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:o,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!s.phone,helperText:(r=s.phone)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"organizationId",control:o,rules:{required:"Organization is required"},render:({field:t})=>{var r;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!s.organizationId,children:[e.jsx(_,{children:"Organization"}),e.jsx(q,{...t,label:"Organization",renderValue:l=>e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(x=>{var p;return e.jsx(F,{component:"span",variant:"body2",children:(p=h==null?void 0:h.find(u=>u.id===x))==null?void 0:p.name},x)})}),children:h==null?void 0:h.map(l=>e.jsx(O,{value:l.id,children:l.name},l.id))}),e.jsx(Y,{children:(r=s.organizationId)==null?void 0:r.message})]})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"currentClassId",control:o,rules:{required:"Current Class is required"},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Current Class",fullWidth:!0,margin:"normal",error:!!s.currentClassId,helperText:(r=s.currentClassId)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"dateOfBirth",control:o,render:({field:t})=>{var r;return e.jsx(w,{label:"Date of Birth",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.dateOfBirth,helperText:(r=s.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"address",control:o,render:({field:{onChange:t,value:r}})=>{var l;return e.jsx(g,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:t,error:!!s.address,helperText:(l=s.address)==null?void 0:l.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:o,render:({field:{onChange:t,value:r}})=>{var l;return e.jsx(g,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:t,error:!!s.email,helperText:(l=s.email)==null?void 0:l.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"enrollmentDate",control:o,render:({field:t})=>{var r;return e.jsx(w,{label:"Enrollment Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.enrollmentDate,helperText:(r=s.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"graduationDate",control:o,render:({field:t})=>{var r;return e.jsx(w,{label:"Graduation Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.graduationDate,helperText:(r=s.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(E,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(M,{variant:"outlined",color:"primary",onClick:()=>{y(S),n()},children:"Cancel"}),e.jsx(M,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function Ce(){const a=Q(),d=N(u=>u.student.data),n=j.useMemo(()=>[{field:"name",headerName:"Student Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"enrolledCoursesIds",headerName:"Enrolled Courses",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"emergencyContacts",headerName:"Emergency Contacts",flex:1,editable:!0,headerClassName:"theme--header"},{field:"graduationDate",headerName:"Graduation Date",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[c,C]=j.useState({}),[f,h]=j.useState(""),[S,o]=j.useState(null),[T,s]=j.useState(!1),{loading:y}=N(u=>u.student);j.useEffect(()=>{a(D.fetchStudents())},[a]);const v=()=>{o(null),h("Add Student"),x()},A=u=>{const P=d==null?void 0:d.students.find(z=>z._id===u);o(P||null),h("Edit Student"),x()},t=async u=>{a(D.deleteStudents(u))},r=async u=>{a(S?D.updateStudents({...u,_id:S._id}):D.createStudents(u)),p()},l=()=>{a(D.fetchStudents())},x=()=>s(!0),p=()=>s(!1);return e.jsxs(E,{sx:{width:"100%",height:"100%"},children:[e.jsx(V,{columns:n,onAdd:v,onDelete:t,onEdit:A,rows:(d==null?void 0:d.students)??[],rowModesModel:c,setRowModesModel:C,loading:y,reloadData:l}),e.jsx(ee,{open:T,onClose:p,title:f,children:e.jsx(ne,{initialValues:S,onSubmit:r,onClose:p})})]})}export{Ce as default};
//# sourceMappingURL=Student.page-BORXwCtf.js.map
