import{ag as R,ah as I,ai as G,v as P,aj as k,ak as U,al as Z,am as $,an as H,ao as J,ap as L,aq as K,J as S,r as g,o as N,j as e,O,T as E,B,p as F,I as Q}from"./index-Wd-8jL93.js";import{u as X,C as c,R as V,G as ee}from"./ReusableDataGrid-PkJBO54C.js";import{G as i}from"./Grid-BItJlU2y.js";import{F as M,I as _,S as z,a as q,T as b}from"./TextField-DVS9y7A2.js";import{D as w}from"./DatePicker-CPBgzmSV.js";import"./useId-f-0gxjm5.js";import"./reselect-BvQ8g9LW.js";import"./Popper-CDsUKxV4.js";import"./Tooltip-CQiT63pF.js";import"./Checkbox-C_gto7pG.js";import"./FormControlLabel-CRMT0ule.js";import"./KeyboardArrowRight-Jv_56AXw.js";import"./CircularProgress-2j3MWkQb.js";import"./Skeleton-BR34Hr5U.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="712cdcdb-87df-417c-a409-02a757a1c3cc",t._sentryDebugIdIdentifier="sentry-dbid-712cdcdb-87df-417c-a409-02a757a1c3cc")}catch{}const ae=()=>async t=>{var n,s;try{t(R());const u=await I.getParents();t(G(u.data.data))}catch(u){P.error(((s=(n=u.response)==null?void 0:n.data)==null?void 0:s.data)||"Failed to fetch organizations",{autoClose:3e3})}},te=t=>async n=>{try{n(L());const s=await I.getParentById(t);n(K(s.data.data))}catch(s){P.error(s.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},re=t=>async n=>{try{n(H());const s=await I.createParent(t);return n(J(s.data.data)),s.data}catch(s){P.error(s.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ne=t=>async n=>{try{if(n(Z()),t._id){const s=await I.updateParent(t,t._id);return n($(s.data.data)),s.data}else throw new Error("Teacher ID is required for update")}catch(s){s instanceof Error&&P.error(s.message||"Failed to fetch organization",{autoClose:3e3})}},se=t=>async n=>{try{n(k());const s=await I.deleteParent(t);n(U(t)),P.info(s.message||"Organization deleted successfully",{autoClose:3e3})}catch(s){console.log(s),P.error(s.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},C={fetchParents:ae,fetchParentById:te,createParents:re,updateParents:ne,deleteParents:se},de=({initialValues:t,onSubmit:n,onClose:s})=>{var A;const{data:u}=S(a=>a.user),{data:y}=S(a=>a.organization),f=(A=u==null?void 0:u.users)==null?void 0:A.filter(a=>a.role==="PARENT"),h=y==null?void 0:y.organizations,j={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",childrenIds:[],dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:o,handleSubmit:T,formState:{errors:d},reset:D}=X({defaultValues:j});g.useEffect(()=>{t&&D({...t,dateOfBirth:t.dateOfBirth?N(t.dateOfBirth):null,createdAt:t.createdAt?N(t.createdAt):null,updatedAt:t.updatedAt?N(t.updatedAt):null})},[t,D]);const v=a=>{const r={...a,dateOfBirth:a.dateOfBirth?a.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:a.createdAt?a.createdAt.format("YYYY-MM-DD"):null,updatedAt:a.updatedAt?a.updatedAt.format("YYYY-MM-DD"):null};n(r)};return e.jsx("form",{onSubmit:T(v),children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"userId",control:o,rules:{required:"User ID is required"},render:({field:a})=>{var r;return e.jsxs(M,{fullWidth:!0,margin:"normal",error:!!d.userId,children:[e.jsx(_,{children:"User ID"}),e.jsx(z,{...a,label:"User ID",renderValue:l=>{var p;return e.jsx(E,{variant:"body2",children:(p=f==null?void 0:f.find(x=>x._id===l))==null?void 0:p.username})},children:f==null?void 0:f.map(l=>e.jsx(O,{value:l._id,children:l.username},l._id))}),e.jsx(q,{children:(r=d.userId)==null?void 0:r.message})]})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"name",control:o,rules:{required:"Name is required"},render:({field:a})=>{var r;return e.jsx(b,{...a,label:"Name",fullWidth:!0,margin:"normal",error:!!d.name,helperText:(r=d.name)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:o,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(b,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!d.phone,helperText:(r=d.phone)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:o,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:a})=>{var r;return e.jsx(b,{...a,label:"Email",fullWidth:!0,margin:"normal",error:!!d.email,helperText:(r=d.email)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:o,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(b,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!d.phone,helperText:(r=d.phone)==null?void 0:r.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"organizationId",control:o,rules:{required:"Organization is required"},render:({field:a})=>{var r;return e.jsxs(M,{fullWidth:!0,margin:"normal",error:!!d.organizationId,children:[e.jsx(_,{children:"Organization"}),e.jsx(z,{...a,label:"Organization",renderValue:l=>e.jsx(B,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(p=>{var x;return e.jsx(E,{component:"span",variant:"body2",children:(x=h==null?void 0:h.find(m=>m.id===p))==null?void 0:x.name},p)})}),children:h==null?void 0:h.map(l=>e.jsx(O,{value:l.id,children:l.name},l.id))}),e.jsx(q,{children:(r=d.organizationId)==null?void 0:r.message})]})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"dateOfBirth",control:o,render:({field:a})=>{var r;return e.jsx(w,{label:"Date of Birth",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!d.dateOfBirth,helperText:(r=d.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"address",control:o,render:({field:{onChange:a,value:r}})=>{var l;return e.jsx(b,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!d.address,helperText:(l=d.address)==null?void 0:l.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:o,render:({field:{onChange:a,value:r}})=>{var l;return e.jsx(b,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!d.email,helperText:(l=d.email)==null?void 0:l.message})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"enrollmentDate",control:o,render:({field:a})=>{var r;return e.jsx(w,{label:"Enrollment Date",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!d.enrollmentDate,helperText:(r=d.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"graduationDate",control:o,render:({field:a})=>{var r;return e.jsx(w,{label:"Graduation Date",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!d.graduationDate,helperText:(r=d.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(B,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(F,{variant:"outlined",color:"primary",onClick:()=>{D(j),s()},children:"Cancel"}),e.jsx(F,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function ye(){const t=Q(),n=S(m=>m.parent.data),s=g.useMemo(()=>[{field:"name",headerName:"Parent Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"occupation",headerName:"Occupation",flex:1,editable:!0,headerClassName:"theme--header"},{field:"relationshipToStudent",headerName:"Relationship to Student",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[u,y]=g.useState({}),[f,h]=g.useState(""),[j,o]=g.useState(null),[T,d]=g.useState(!1),{loading:D}=S(m=>m.parent);g.useEffect(()=>{t(C.fetchParents())},[t]);const v=()=>{o(null),h("Add Parent"),p()},A=m=>{const W=n==null?void 0:n.parents.find(Y=>Y._id===m);o(W||null),h("Edit Parent"),p()},a=async m=>{t(C.deleteParents(m))},r=async m=>{t(j?C.updateParents({...m,_id:j._id}):C.createParents(m)),x()},l=()=>{t(C.fetchParents())},p=()=>d(!0),x=()=>d(!1);return e.jsxs(B,{sx:{width:"100%",height:"100%"},children:[e.jsx(V,{columns:s,onAdd:v,onDelete:a,onEdit:A,rows:(n==null?void 0:n.parents)??[],rowModesModel:u,setRowModesModel:y,loading:D,reloadData:l}),e.jsx(ee,{open:T,onClose:x,title:f,children:e.jsx(de,{initialValues:j,onSubmit:r,onClose:x})})]})}export{ye as default};
//# sourceMappingURL=Parent.page-CBDgNUJp.js.map
