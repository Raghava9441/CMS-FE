import{r as m,o as R,j as r,B as C,p as j,q as M,A as w,t as F,v as z,x as P,y as W,z as B,C as G,E as L,F as U,G as Y,H as k,I as Z,J as O}from"./index-Wd-8jL93.js";import{u as $,C as f,R as H,G as J}from"./ReusableDataGrid-PkJBO54C.js";import{G as u}from"./Grid-BItJlU2y.js";import{T as g}from"./TextField-DVS9y7A2.js";import{D as K}from"./DatePicker-CPBgzmSV.js";import"./useId-f-0gxjm5.js";import"./reselect-BvQ8g9LW.js";import"./Popper-CDsUKxV4.js";import"./Tooltip-CQiT63pF.js";import"./Checkbox-C_gto7pG.js";import"./FormControlLabel-CRMT0ule.js";import"./KeyboardArrowRight-Jv_56AXw.js";import"./CircularProgress-2j3MWkQb.js";import"./Skeleton-BR34Hr5U.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="eb1483e8-a965-444e-baa8-6d76b33f78d6",e._sentryDebugIdIdentifier="sentry-dbid-eb1483e8-a965-444e-baa8-6d76b33f78d6")}catch{}const Q={ADMIN:{organizations:{view:!0,create:!0,update:!0,delete:!0},teachers:{view:!0,create:!0,update:!0,delete:!0},students:{view:!0,create:!0,update:!0,delete:!0},parents:{view:!0,create:!0,update:!0,delete:!0},departments:{view:!0,create:!0,update:!0,delete:!0},classes:{view:!0,create:!0,update:!0,delete:!0},courses:{view:!0,create:!0,update:!0,delete:!0},events:{view:!0,create:!0,update:!0,delete:!0},assignments:{view:!0,create:!0,update:!0,delete:!0},exams:{view:!0,create:!0,update:!0,delete:!0},attendances:{view:!0,create:!0,update:!0,delete:!0},notifications:{view:!0,create:!0,update:!0,delete:!0},settings:{view:!0,create:!0,update:!0,delete:!0}},TEACHER:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:(e,a)=>e.id===a.id,delete:!1},students:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:!1},assignments:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},exams:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},attendances:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},notifications:{view:!0,create:!1,update:!1,delete:!1},settings:{view:!0,create:!0,update:!0,delete:!1}},STUDENT:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:(e,a)=>e.organizationId===a._id,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}},PARENT:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}},ORGADMIN:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}}};function X(e,a,i,o){var n;const d=e.role,c=(n=Q[d][a])==null?void 0:n[i];return c==null?!1:typeof c=="boolean"?c:o!=null&&c(e,o)}const V=({initialValues:e,onSubmit:a,onClose:i})=>{const o={_id:"",name:"",category:"",number:"",contactEmail:"",contactPhone:"",website:"",logo:"",establishedDate:null,description:""},{control:d,handleSubmit:c,formState:{errors:n},reset:p}=$({defaultValues:o});m.useEffect(()=>{e&&p({...e,establishedDate:e.establishedDate?R(e.establishedDate):null})},[e,p]);const h=s=>{const t={...s,establishedDate:s.establishedDate?s.establishedDate.format("YYYY-MM-DD"):null};a(t)};return r.jsx("form",{onSubmit:c(h),children:r.jsxs(u,{container:!0,spacing:2,children:[r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"name",control:d,rules:{required:"Name is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Name",size:"small",fullWidth:!0,margin:"normal",error:!!n.name,helperText:(t=n.name)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"category",control:d,rules:{required:"Category is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Category",size:"small",fullWidth:!0,margin:"normal",error:!!n.category,helperText:(t=n.category)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"number",control:d,rules:{required:"Number is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Number",size:"small",fullWidth:!0,margin:"normal",error:!!n.number,helperText:(t=n.number)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"contactEmail",control:d,rules:{required:"Contact email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Contact Email",size:"small",fullWidth:!0,margin:"normal",error:!!n.contactEmail,helperText:(t=n.contactEmail)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"contactPhone",control:d,rules:{required:"Contact phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Contact Phone",size:"small",fullWidth:!0,margin:"normal",error:!!n.contactPhone,helperText:(t=n.contactPhone)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"website",control:d,rules:{required:"Website is required",pattern:{value:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,message:"Invalid website URL"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Website",size:"small",fullWidth:!0,margin:"normal",error:!!n.website,helperText:(t=n.website)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"logo",control:d,rules:{required:"Logo URL is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Logo URL",size:"small",fullWidth:!0,margin:"normal",error:!!n.logo,helperText:(t=n.logo)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"establishedDate",control:d,rules:{required:"Established date is required"},render:({field:s})=>{var t;return r.jsx(K,{label:"Established Date",value:s.value,onChange:v=>s.onChange(v),slotProps:{textField:{size:"small",fullWidth:!0,margin:"normal",error:!!n.establishedDate,helperText:(t=n.establishedDate)==null?void 0:t.message}}})}})}),r.jsx(u,{item:!0,xs:12,children:r.jsx(f,{name:"description",control:d,rules:{required:"Description is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,size:"small",label:"Description",fullWidth:!0,multiline:!0,rows:4,margin:"normal",error:!!n.description,helperText:(t=n.description)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,children:r.jsxs(C,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[r.jsx(j,{variant:"outlined",color:"primary",onClick:()=>{p(o),i()},children:"Cancel"}),r.jsx(j,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})},ee=()=>async e=>{var a,i;try{e(M());const o=await w.getOrganizations();console.log(o),e(F(o.data.data))}catch(o){z.error(((i=(a=o.response)==null?void 0:a.data)==null?void 0:i.data)||"Failed to fetch organizations",{autoClose:3e3})}},ae=e=>async a=>{try{a(Y());const i=await w.getOrganizationById(e);a(k(i.data.data))}catch(i){z.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},te=e=>async a=>{try{a(L());const i=await w.createOrganization(e);return a(U(i.data.data)),i.data}catch(i){z.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},re=e=>async a=>{try{a(B());const i=await w.updateOrganization(e,e.id);return a(G(i.data.data)),i.data}catch(i){z.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ie=e=>async a=>{var i,o;try{a(P());const d=await w.deleteOrganization(e);a(W(e)),z.info("Organization deleted successfully",{autoClose:3e3})}catch(d){z.error(((o=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:o.data)||"Failed to fetch organization",{autoClose:3e3})}},I={fetchOrganizations:ee,fetchOrganizationById:ae,createOrganization:te,updateOrganization:re,deleteOrganization:ie};function we(){const e=Z(),a=m.useMemo(()=>[{field:"name",headerName:"Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"category",headerName:"Category",flex:1,editable:!0,headerClassName:"theme--header"},{field:"number",headerName:"Number",flex:1,editable:!0,headerClassName:"theme--header"},{field:"contactEmail",headerName:"Contact Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"contactPhone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"establishedDate",headerName:"Established Date",flex:1,editable:!0,headerClassName:"theme--header"},{field:"description",headerName:"Description",flex:1,editable:!0,headerClassName:"theme--header"}],[]),[i,o]=m.useState({}),[d,c]=m.useState(!1),[n,p]=m.useState(void 0),[h,s]=m.useState(null),{data:t,loading:v}=O(l=>l.organization),x=O(l=>l.auth.user),D=m.useMemo(()=>!x||!(t!=null&&t.organizations)?[]:t.organizations.filter(l=>X(x,"organizations","view",l)),[x,t]);m.useEffect(()=>{var l;((l=t==null?void 0:t.organizations)==null?void 0:l.length)===void 0&&e(I.fetchOrganizations())},[e]);const S=()=>{s(null),p("Add Organization"),_()},E=l=>{const y=t==null?void 0:t.organizations.find(A=>A._id===l);console.log("selectedOrganization",y),s(y),p("Edit Organization"),_()},N=async l=>{e(I.deleteOrganization(l))},q=async l=>{e(h?I.updateOrganization({id:h._id,...l}):I.createOrganization(l)),b()},T=()=>{e(I.fetchOrganizations())},_=()=>c(!0),b=()=>c(!1);return r.jsxs(C,{sx:{width:"100%",height:"100%"},children:[r.jsx(H,{columns:a,onAdd:S,onDelete:N,onEdit:E,rows:D??[],rowModesModel:i,setRowModesModel:o,loading:v,reloadData:T}),r.jsx(J,{open:d,onClose:b,title:n,children:r.jsx(V,{initialValues:h,onSubmit:q,onClose:b})})]})}export{we as default};
//# sourceMappingURL=Organizations-45vzgKUf.js.map
