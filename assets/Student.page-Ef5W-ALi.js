import{q as $,a6 as Q,a7 as A,a8 as H,x as y,a9 as J,aa as K,ab as L,ac as X,ad as V,ae as ee,af as te,ag as ae,K as v,r as S,o as O,j as e,Q as M,T as q,B as E,p as W,J as re}from"./index-SRrTBXCC.js";import{u as se,C as m,a as ne,R as de,G as le}from"./usePaginationParams-DxAbNu5X.js";import{G as u}from"./Grid-Gh5MVjop.js";import{F as _,I as Y,S as z,a as R,T as g}from"./TextField-Ck7cFlxI.js";import{D as P}from"./DatePicker-Dnj570HZ.js";import"./useId-CZ066Zps.js";import"./reselect-fumL3tiG.js";import"./Popper-DBdlVSYc.js";import"./Tooltip-CARQlZDD.js";import"./Checkbox-CbKKmzbx.js";import"./FormControlLabel-BJOqXBEo.js";import"./KeyboardArrowRight-BPEmQlsH.js";import"./CircularProgress-MJR8981s.js";import"./Skeleton-D2PZNTa9.js";try{let r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new r.Error().stack;s&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[s]="c73eb14c-d6d4-4acd-9ff5-004413302d0a",r._sentryDebugIdIdentifier="sentry-dbid-c73eb14c-d6d4-4acd-9ff5-004413302d0a")}catch{}const oe=r=>async s=>{var d,f;try{const h=$(r);s(Q());const c=await A.getStudents(h);s(H(c.data.data))}catch(h){y.error(((f=(d=h.response)==null?void 0:d.data)==null?void 0:f.data)||"Failed to fetch students",{autoClose:3e3})}},ie=r=>async s=>{try{s(te());const d=await A.getStudentById(r);s(ae(d.data.data))}catch(d){y.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},ue=r=>async s=>{try{s(V());const d=await A.createStudent(r);return s(ee(d.data.data)),d.data}catch(d){y.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},me=r=>async s=>{try{s(L());const d=await A.updateStudent(r,r._id);return s(X(d.data.data)),d.data}catch(d){y.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},ce=r=>async s=>{try{s(J());const d=await A.deleteStudent(r);s(K(r)),y.info(d.message||"Student deleted successfully",{autoClose:3e3})}catch(d){console.log(d),y.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},I={fetchStudents:oe,fetchStudentById:ie,createStudents:ue,updateStudents:me,deleteStudents:ce},he=({initialValues:r,onSubmit:s,onClose:d})=>{var C;const{data:f}=v(t=>t.user),{data:h}=v(t=>t.organization),c=(C=f==null?void 0:f.users)==null?void 0:C.filter(t=>t.role==="STUDENT"),x=h==null?void 0:h.organizations,j={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",enrolledCoursesIds:[],currentClassId:"",dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:N,formState:{errors:n},reset:D}=se({defaultValues:j});S.useEffect(()=>{r&&D({...r,dateOfBirth:r.dateOfBirth?O(r.dateOfBirth):null,createdAt:r.createdAt?O(r.createdAt):null,updatedAt:r.updatedAt?O(r.updatedAt):null})},[r,D]);const T=t=>{const a={...t,dateOfBirth:t.dateOfBirth?t.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:t.createdAt?t.createdAt.format("YYYY-MM-DD"):null,updatedAt:t.updatedAt?t.updatedAt.format("YYYY-MM-DD"):null};s(a)};return e.jsx("form",{onSubmit:N(T),children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:t})=>{var a;return e.jsxs(_,{fullWidth:!0,margin:"normal",error:!!n.userId,children:[e.jsx(Y,{children:"User ID"}),e.jsx(z,{...t,label:"User ID",renderValue:l=>{var p;return e.jsx(q,{variant:"body2",children:(p=c==null?void 0:c.find(b=>b._id===l))==null?void 0:p.username})},children:c==null?void 0:c.map(l=>e.jsx(M,{value:l._id,children:l.username},l._id))}),e.jsx(R,{children:(a=n.userId)==null?void 0:a.message})]})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"name",control:i,rules:{required:"Name is required"},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Name",fullWidth:!0,margin:"normal",error:!!n.name,helperText:(a=n.name)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!n.phone,helperText:(a=n.phone)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Email",fullWidth:!0,margin:"normal",error:!!n.email,helperText:(a=n.email)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!n.phone,helperText:(a=n.phone)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:t})=>{var a;return e.jsxs(_,{fullWidth:!0,margin:"normal",error:!!n.organizationId,children:[e.jsx(Y,{children:"Organization"}),e.jsx(z,{...t,label:"Organization",renderValue:l=>e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(p=>{var b;return e.jsx(q,{component:"span",variant:"body2",children:(b=x==null?void 0:x.find(B=>B.id===p))==null?void 0:b.name},p)})}),children:x==null?void 0:x.map(l=>e.jsx(M,{value:l.id,children:l.name},l.id))}),e.jsx(R,{children:(a=n.organizationId)==null?void 0:a.message})]})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"currentClassId",control:i,rules:{required:"Current Class is required"},render:({field:t})=>{var a;return e.jsx(g,{...t,label:"Current Class",fullWidth:!0,margin:"normal",error:!!n.currentClassId,helperText:(a=n.currentClassId)==null?void 0:a.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"dateOfBirth",control:i,render:({field:t})=>{var a;return e.jsx(P,{label:"Date of Birth",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!n.dateOfBirth,helperText:(a=n.dateOfBirth)==null?void 0:a.message}}})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"address",control:i,render:({field:{onChange:t,value:a}})=>{var l;return e.jsx(g,{label:"Address",fullWidth:!0,margin:"normal",value:a,onChange:t,error:!!n.address,helperText:(l=n.address)==null?void 0:l.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:i,render:({field:{onChange:t,value:a}})=>{var l;return e.jsx(g,{label:"Email",fullWidth:!0,margin:"normal",value:a,onChange:t,error:!!n.email,helperText:(l=n.email)==null?void 0:l.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"enrollmentDate",control:i,render:({field:t})=>{var a;return e.jsx(P,{label:"Enrollment Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!n.enrollmentDate,helperText:(a=n.enrollmentDate)==null?void 0:a.message}}})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"graduationDate",control:i,render:({field:t})=>{var a;return e.jsx(P,{label:"Graduation Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!n.graduationDate,helperText:(a=n.graduationDate)==null?void 0:a.message}}})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(E,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(W,{variant:"outlined",color:"primary",onClick:()=>{D(j),d()},children:"Cancel"}),e.jsx(W,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function Te(){const r=re(),s=v(o=>o.student.data),d=S.useMemo(()=>[{field:"name",headerName:"Student Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"enrolledCoursesIds",headerName:"Enrolled Courses",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"emergencyContacts",headerName:"Emergency Contacts",flex:1,editable:!0,headerClassName:"theme--header"},{field:"graduationDate",headerName:"Graduation Date",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[f,h]=S.useState({}),[c,x]=S.useState(""),[j,i]=S.useState(null),[N,n]=S.useState(!1),{loading:D}=v(o=>o.student),T=S.useCallback(o=>{r(I.fetchStudents(o))},[r]),{params:C,setParams:t}=ne({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},T),a=o=>{t(o)},l=()=>{i(null),x("Add Student"),F()},p=o=>{const U=s==null?void 0:s.students.find(Z=>Z._id===o);i(U||null),x("Edit Student"),F()},b=async o=>{r(I.deleteStudents(o))},B=async o=>{r(j?I.updateStudents({...o,_id:j._id}):I.createStudents(o)),w()},G=()=>{r(I.fetchStudents(C))},F=()=>n(!0),w=()=>n(!1),k=(s==null?void 0:s.totalStudents)||0;return e.jsxs(E,{sx:{width:"100%",height:"100%"},children:[e.jsx(de,{columns:d,onAdd:l,onDelete:b,onEdit:p,rows:(s==null?void 0:s.students)??[],rowModesModel:f,setRowModesModel:h,loading:D,reloadData:G,totalRows:k,paginationModel:{page:C.page-1,pageSize:C.limit},onParamsChange:o=>a(o)}),e.jsx(le,{open:N,onClose:w,title:c,children:e.jsx(he,{initialValues:j,onSubmit:B,onClose:w})})]})}export{Te as default};
//# sourceMappingURL=Student.page-Ef5W-ALi.js.map
