import{r as m,d as R,j as r,B as C,a as O,f as M,A as v,b as P,c as p,e as W,g as F,u as B,h as G,i as L,k as U,l as Y,m as k,n as Z,o as y}from"./index-Dyi3jE4l.js";import{u as $,C as f,R as H,G as J}from"./ReusableDataGrid-CbG7o0aG.js";import{G as u}from"./Grid-CeEu2qV9.js";import{T as g}from"./TextField-QIY4dj0f.js";import{D as K}from"./DatePicker-Bh_1YINJ.js";import"./useId-CJBthdim.js";import"./Tooltip-BhIvhh55.js";import"./Checkbox-C97MMspO.js";import"./FormControlLabel-Cw15UdGH.js";import"./KeyboardArrowRight-DWuFVZKL.js";import"./CircularProgress-OTS2vmjB.js";import"./Skeleton-BGplmk-x.js";const Q={ADMIN:{organizations:{view:!0,create:!0,update:!0,delete:!0},teachers:{view:!0,create:!0,update:!0,delete:!0},students:{view:!0,create:!0,update:!0,delete:!0},parents:{view:!0,create:!0,update:!0,delete:!0},departments:{view:!0,create:!0,update:!0,delete:!0},classes:{view:!0,create:!0,update:!0,delete:!0},courses:{view:!0,create:!0,update:!0,delete:!0},events:{view:!0,create:!0,update:!0,delete:!0},assignments:{view:!0,create:!0,update:!0,delete:!0},exams:{view:!0,create:!0,update:!0,delete:!0},attendances:{view:!0,create:!0,update:!0,delete:!0},notifications:{view:!0,create:!0,update:!0,delete:!0},settings:{view:!0,create:!0,update:!0,delete:!0}},TEACHER:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:(e,a)=>e.id===a.id,delete:!1},students:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a.organizationId,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:!1},assignments:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},exams:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},attendances:{view:(e,a)=>e.organizationId===a.organizationId,create:(e,a)=>e.organizationId===a.organizationId,update:(e,a)=>e.organizationId===a.organizationId,delete:(e,a)=>e.organizationId===a.organizationId},notifications:{view:!0,create:!1,update:!1,delete:!1},settings:{view:!0,create:!0,update:!0,delete:!1}},STUDENT:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:(e,a)=>e.organizationId===a._id,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}},PARENT:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}},ORGADMIN:{organizations:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},teachers:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},students:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},parents:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},departments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},classes:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},courses:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},events:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},assignments:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},exams:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},attendances:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},notifications:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1},settings:{view:(e,a)=>e.organizationId===a._id,create:!1,update:!1,delete:!1}}};function X(e,a,i,d){var n;const o=e.role,c=(n=Q[o][a])==null?void 0:n[i];return c==null?!1:typeof c=="boolean"?c:d!=null&&c(e,d)}const V=({initialValues:e,onSubmit:a,onClose:i})=>{const d={_id:"",name:"",category:"",number:"",contactEmail:"",contactPhone:"",website:"",logo:"",establishedDate:null,description:""},{control:o,handleSubmit:c,formState:{errors:n},reset:z}=$({defaultValues:d});m.useEffect(()=>{e&&z({...e,establishedDate:e.establishedDate?R(e.establishedDate):null})},[e,z]);const h=s=>{const t={...s,establishedDate:s.establishedDate?s.establishedDate.format("YYYY-MM-DD"):null};a(t)};return r.jsx("form",{onSubmit:c(h),children:r.jsxs(u,{container:!0,spacing:2,children:[r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"name",control:o,rules:{required:"Name is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Name",size:"small",fullWidth:!0,margin:"normal",error:!!n.name,helperText:(t=n.name)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"category",control:o,rules:{required:"Category is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Category",size:"small",fullWidth:!0,margin:"normal",error:!!n.category,helperText:(t=n.category)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"number",control:o,rules:{required:"Number is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Number",size:"small",fullWidth:!0,margin:"normal",error:!!n.number,helperText:(t=n.number)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"contactEmail",control:o,rules:{required:"Contact email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Contact Email",size:"small",fullWidth:!0,margin:"normal",error:!!n.contactEmail,helperText:(t=n.contactEmail)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"contactPhone",control:o,rules:{required:"Contact phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Contact Phone",size:"small",fullWidth:!0,margin:"normal",error:!!n.contactPhone,helperText:(t=n.contactPhone)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"website",control:o,rules:{required:"Website is required",pattern:{value:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,message:"Invalid website URL"}},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Website",size:"small",fullWidth:!0,margin:"normal",error:!!n.website,helperText:(t=n.website)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"logo",control:o,rules:{required:"Logo URL is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,label:"Logo URL",size:"small",fullWidth:!0,margin:"normal",error:!!n.logo,helperText:(t=n.logo)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,md:6,children:r.jsx(f,{name:"establishedDate",control:o,rules:{required:"Established date is required"},render:({field:s})=>{var t;return r.jsx(K,{label:"Established Date",value:s.value,onChange:w=>s.onChange(w),slotProps:{textField:{size:"small",fullWidth:!0,margin:"normal",error:!!n.establishedDate,helperText:(t=n.establishedDate)==null?void 0:t.message}}})}})}),r.jsx(u,{item:!0,xs:12,children:r.jsx(f,{name:"description",control:o,rules:{required:"Description is required"},render:({field:s})=>{var t;return r.jsx(g,{...s,size:"small",label:"Description",fullWidth:!0,multiline:!0,rows:4,margin:"normal",error:!!n.description,helperText:(t=n.description)==null?void 0:t.message})}})}),r.jsx(u,{item:!0,xs:12,children:r.jsxs(C,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[r.jsx(O,{variant:"outlined",color:"primary",onClick:()=>{z(d),i()},children:"Cancel"}),r.jsx(O,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})},ee=()=>async e=>{var a,i;try{e(M());const d=await v.getOrganizations();console.log(d),e(P(d.data.data))}catch(d){p.error(((i=(a=d.response)==null?void 0:a.data)==null?void 0:i.data)||"Failed to fetch organizations",{autoClose:3e3})}},ae=e=>async a=>{try{a(Y());const i=await v.getOrganizationById(e);a(k(i.data.data))}catch(i){p.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},te=e=>async a=>{try{a(L());const i=await v.createOrganization(e);return a(U(i.data.data)),i.data}catch(i){p.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},re=e=>async a=>{try{a(B());const i=await v.updateOrganization(e,e.id);return a(G(i.data.data)),i.data}catch(i){p.error(i.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ie=e=>async a=>{var i,d;try{a(W());const o=await v.deleteOrganization(e);a(F(e)),p.info("Organization deleted successfully",{autoClose:3e3})}catch(o){p.error(((d=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:d.data)||"Failed to fetch organization",{autoClose:3e3})}},I={fetchOrganizations:ee,fetchOrganizationById:ae,createOrganization:te,updateOrganization:re,deleteOrganization:ie};function he(){const e=Z(),a=m.useMemo(()=>[{field:"name",headerName:"Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"category",headerName:"Category",flex:1,editable:!0,headerClassName:"theme--header"},{field:"number",headerName:"Number",flex:1,editable:!0,headerClassName:"theme--header"},{field:"contactEmail",headerName:"Contact Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"contactPhone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"establishedDate",headerName:"Established Date",flex:1,editable:!0,headerClassName:"theme--header"},{field:"description",headerName:"Description",flex:1,editable:!0,headerClassName:"theme--header"}],[]),[i,d]=m.useState({}),[o,c]=m.useState(!1),[n,z]=m.useState(void 0),[h,s]=m.useState(null),{data:t,loading:w}=y(l=>l.organization),x=y(l=>l.auth.user),D=m.useMemo(()=>!x||!(t!=null&&t.organizations)?[]:t.organizations.filter(l=>X(x,"organizations","view",l)),[x,t]);m.useEffect(()=>{var l;((l=t==null?void 0:t.organizations)==null?void 0:l.length)===void 0&&e(I.fetchOrganizations())},[e]);const S=()=>{s(null),z("Add Organization"),_()},N=l=>{const j=t==null?void 0:t.organizations.find(A=>A._id===l);console.log("selectedOrganization",j),s(j),z("Edit Organization"),_()},E=async l=>{e(I.deleteOrganization(l))},q=async l=>{e(h?I.updateOrganization({id:h._id,...l}):I.createOrganization(l)),b()},T=()=>{e(I.fetchOrganizations())},_=()=>c(!0),b=()=>c(!1);return r.jsxs(C,{sx:{width:"100%",height:"100%"},children:[r.jsx(H,{columns:a,onAdd:S,onDelete:E,onEdit:N,rows:D??[],rowModesModel:i,setRowModesModel:d,loading:w,reloadData:T}),r.jsx(J,{open:o,onClose:b,title:n,children:r.jsx(V,{initialValues:h,onSubmit:q,onClose:b})})]})}export{he as default};
