import{C as y,E as v,r as u,F as C,j as s,G as j,H as T,I as w,K as L,X as S,J as D,ab as Q,T as R,A as V,P as E,B as g,ad as W,ae as J,az as M,u as H,b as G,cK as I,aA as _,a as q,$ as P}from"./index-Iayj6iCM.js";import{S as Y}from"./Save-Cbz7BGnc.js";import{a as Z,b as $,c as f,S as B,T as ee}from"./Search-CyrNpi08.js";import{S as se}from"./Switch-MdbsBG70.js";import{T as te}from"./TextField-BucTJljM.js";import{I as z}from"./InputAdornment-B1la7Cdg.js";import{a as oe}from"./auth.actions-BDLVLHgo.js";import{C as ae}from"./Container-C2gE_a6a.js";import{L as re}from"./LinearProgress-CCvmoNmW.js";import"./isHostComponent-Byq13FOA.js";import"./KeyboardArrowRight-B2v7g9ly.js";import"./InputBase-BjWt6y8l.js";import"./Modal-CwWs3I4F.js";import"./MenuItem-B4ZcixFb.js";import"./List-Bn0p357_.js";import"./listItemTextClasses-D33cD7Dv.js";import"./Toolbar-Dy84SFcE.js";import"./SwitchBase-eVy0UzNH.js";import"./Menu-4fDYuzS_.js";function ne(e){return y("MuiTable",e)}v("MuiTable",["root","stickyHeader"]);const le=e=>{const{classes:t,stickyHeader:o}=e;return w({root:["root",o&&"stickyHeader"]},ne,t)},ie=j("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.stickyHeader&&t.stickyHeader]}})(L(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),N="table",ce=u.forwardRef(function(t,o){const a=C({props:t,name:"MuiTable"}),{className:i,component:r=N,padding:n="normal",size:l="medium",stickyHeader:d=!1,...p}=a,x={...a,component:r,padding:n,size:l,stickyHeader:d},m=le(x),b=u.useMemo(()=>({padding:n,size:l,stickyHeader:d}),[n,l,d]);return s.jsx(Z.Provider,{value:b,children:s.jsx(ie,{as:r,role:r===N?null:"table",ref:o,className:T(m.root,i),ownerState:x,...p})})});function de(e){return y("MuiTableBody",e)}v("MuiTableBody",["root"]);const pe=e=>{const{classes:t}=e;return w({root:["root"]},de,t)},ue=j("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-row-group"}),me={variant:"body"},U="tbody",he=u.forwardRef(function(t,o){const a=C({props:t,name:"MuiTableBody"}),{className:i,component:r=U,...n}=a,l={...a,component:r},d=pe(l);return s.jsx($.Provider,{value:me,children:s.jsx(ue,{className:T(d.root,i),as:r,ref:o,role:r===U?null:"rowgroup",ownerState:l,...n})})});function xe(e){return y("MuiTableContainer",e)}v("MuiTableContainer",["root"]);const ge=e=>{const{classes:t}=e;return w({root:["root"]},xe,t)},be=j("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),fe=u.forwardRef(function(t,o){const a=C({props:t,name:"MuiTableContainer"}),{className:i,component:r="div",...n}=a,l={...a,component:r},d=ge(l);return s.jsx(be,{ref:o,as:r,className:T(d.root,i),ownerState:l,...n})});function ye(e){return y("MuiTableHead",e)}v("MuiTableHead",["root"]);const ve=e=>{const{classes:t}=e;return w({root:["root"]},ye,t)},Ce=j("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),je={variant:"head"},F="thead",Te=u.forwardRef(function(t,o){const a=C({props:t,name:"MuiTableHead"}),{className:i,component:r=F,...n}=a,l={...a,component:r},d=ve(l);return s.jsx($.Provider,{value:je,children:s.jsx(Ce,{as:r,className:T(d.root,i),ref:o,role:r===F?null:"rowgroup",ownerState:l,...n})})});function we(e){return y("MuiTableRow",e)}const O=v("MuiTableRow",["root","selected","hover","head","footer"]),Re=e=>{const{classes:t,selected:o,hover:a,head:i,footer:r}=e;return w({root:["root",o&&"selected",a&&"hover",i&&"head",r&&"footer"]},we,t)},Se=j("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.head&&t.head,o.footer&&t.footer]}})(L(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${O.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${O.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:S(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:S(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}}))),A="tr",k=u.forwardRef(function(t,o){const a=C({props:t,name:"MuiTableRow"}),{className:i,component:r=A,hover:n=!1,selected:l=!1,...d}=a,p=u.useContext($),x={...a,component:r,hover:n,selected:l,head:p&&p.variant==="head",footer:p&&p.variant==="footer"},m=Re(x);return s.jsx(Se,{as:r,ref:o,className:T(m.root,i),role:r===A?null:"row",ownerState:x,...d})}),Pe=D(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),Me=D(s.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList");function ke(e=[]){const[t,o]=u.useState(e),a=u.useCallback((i,r)=>{o(n=>n.map((l,d)=>d===i?{...l,[r]:!l[r]}:l))},[]);return{permissions:t,toggle:a,setPermissions:o}}const $e=({index:e,permission:t,onToggle:o})=>s.jsxs(k,{children:[s.jsx(f,{sx:{padding:"0px",paddingX:"10px"},children:s.jsx(R,{variant:"body1",fontWeight:"medium",children:t.name})}),["view","edit","delete"].map(a=>s.jsx(f,{align:"center",sx:{padding:"0px"},children:s.jsx(se,{checked:t[a],onChange:()=>o(e,a),color:a==="delete"?"error":"primary",inputProps:{"aria-label":`${t.name}-${a}`}})},a))]}),He=Q.memo($e),Ie=({permissions:e,onToggle:t})=>{const o=V(),[a,i]=u.useState(""),[r,n]=u.useState(0),[l,d]=u.useState(10),p=e.filter(c=>c.name.toLowerCase().includes(a.toLowerCase())||c.description&&c.description.toLowerCase().includes(a.toLowerCase())),x=(c,h)=>{n(h)},m=c=>{d(parseInt(c.target.value,10)),n(0)},b=p.slice(r*l,r*l+l);return s.jsxs(E,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:2,overflow:"hidden"},children:[s.jsxs(g,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[s.jsx(te,{fullWidth:!0,variant:"outlined",placeholder:"Search features...",value:a,onChange:c=>{i(c.target.value),n(0)},InputProps:{startAdornment:s.jsx(z,{position:"start",children:s.jsx(B,{color:"action"})}),endAdornment:a&&s.jsx(z,{position:"end",children:s.jsx(W,{title:"Clear search",children:s.jsx(J,{size:"small",onClick:()=>i(""),edge:"end",children:s.jsx(Pe,{fontSize:"small"})})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:1}}}),a&&s.jsxs(R,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Found ",p.length," feature",p.length!==1?"s":""]})]}),s.jsx(fe,{sx:{flex:1,overflow:"auto"},children:s.jsxs(ce,{size:"medium",stickyHeader:!0,children:[s.jsx(Te,{children:s.jsxs(k,{children:[s.jsx(f,{sx:{fontWeight:600,backgroundColor:S(o.palette.primary.main,.05),borderBottom:`2px solid ${o.palette.primary.main}`,py:2,minWidth:250},children:s.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(Me,{fontSize:"small",color:"primary"}),s.jsx("span",{children:"Feature"})]})}),["View","Edit","Delete"].map(c=>s.jsx(f,{align:"center",sx:{fontWeight:600,backgroundColor:S(o.palette.primary.main,.05),borderBottom:`2px solid ${o.palette.primary.main}`,py:2,width:120},children:s.jsx(M,{label:c,size:"small",color:c==="Delete"?"error":c==="Edit"?"primary":"success",variant:"outlined",sx:{fontWeight:600}})},c))]})}),s.jsx(he,{children:b.length>0?b.map((c,h)=>{const X=e.findIndex(K=>K.name===c.name);return s.jsx(He,{index:X,permission:c,onToggle:t},c.name)}):s.jsx(k,{children:s.jsx(f,{colSpan:4,align:"center",sx:{py:8},children:s.jsxs(g,{sx:{textAlign:"center",color:"text.secondary"},children:[s.jsx(B,{sx:{fontSize:48,mb:2,opacity:.5}}),s.jsx(R,{variant:"h6",gutterBottom:!0,children:a?"No matching features found":"No features available"}),s.jsx(R,{variant:"body2",children:a?"Try a different search term":"Add features to get started"})]})})})})]})}),p.length>0&&s.jsx(ee,{rowsPerPageOptions:[5,10,25],component:"div",count:p.length,rowsPerPage:l,page:r,onPageChange:x,onRowsPerPageChange:m,sx:{borderTop:1,borderColor:"divider"}})]})};function Ye(){const e=H(h=>h.auth.permissions),{_id:t}=H(h=>h.auth.user),[o,a]=u.useState(!1),[i,r]=u.useState(!1),{permissions:n,toggle:l,setPermissions:d}=ke(e),p=G(),[x,m]=u.useState(!1);u.useEffect(()=>{d(e)},[e]),u.useEffect(()=>{const h=JSON.stringify(n)!==JSON.stringify(e);r(h)},[n,e]);const b=async()=>{a(!0);try{await p(oe.updatePermissions(n,t)),p(P({severity:"success",message:"Permissions saved successfully!"})),m(!0),r(!1)}catch{p(P({severity:"error",message:"Error saving permissions. Please try again."})),m(!0)}finally{a(!1)}},c=()=>{d(e),p(P({severity:"info",message:"Changes discarded. Original permissions restored."})),m(!0),r(!1)};return s.jsxs(ae,{maxWidth:"lg",sx:{height:"100vh",display:"flex",flexDirection:"column",p:0},style:{padding:0},children:[s.jsxs(E,{elevation:1,sx:{p:1,mb:3,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[s.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(M,{label:`${n.length} Features`,color:"primary",variant:"outlined",size:"small"}),i&&s.jsx(I,{in:i,children:s.jsx(M,{label:"Unsaved Changes",color:"warning",size:"small",sx:{animation:"pulse 2s infinite"}})})]}),s.jsxs(g,{sx:{display:"flex",gap:1},children:[s.jsx(W,{title:"Discard changes",children:s.jsx(J,{onClick:c,disabled:!i||o,size:"small",sx:{border:"1px solid",borderColor:"divider",borderRadius:1},children:s.jsx(_,{})})}),s.jsx(q,{variant:"contained",startIcon:s.jsx(Y,{}),onClick:b,disabled:!i||n.length===0||o,sx:{background:"linear-gradient(45deg, #2e7d32 0%, #4caf50 100%)",color:"white",px:3,borderRadius:2,"&:hover":{background:"linear-gradient(45deg, #1b5e20 0%, #388e3c 100%)"},"&:disabled":{background:"#e0e0e0"}},children:o?"Saving...":"Save Changes"})]})]}),o&&s.jsx(re,{sx:{mb:2,borderRadius:1,height:4}}),s.jsx(g,{sx:{flex:1,overflow:"hidden",minHeight:0},children:s.jsx(I,{in:!o,children:s.jsx(g,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:s.jsx(Ie,{permissions:n,onToggle:l})})})})]})}export{Ye as default};
