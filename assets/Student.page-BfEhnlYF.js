import{p as J,aQ as K,aR as I,aS as V,h as C,aT as ee,aU as te,aV as re,aW as ae,aX as se,aY as ne,aZ as de,a_ as le,u as O,r as S,d as w,j as e,T as Y,B as E,a as q,b as oe,v as ie,w as ue,O as me,z as ce}from"./index-Iayj6iCM.js";import he from"./GenericModal-DzEREtr7.js";import{u as pe,R as xe}from"./usePaginationParams-D-EadkPr.js";import{u as fe,C as m}from"./index.esm-DT5DRIWP.js";import{G as u}from"./Grid-CPbLDtt5.js";import{F as R,I as _,S as z,a as U,T as g}from"./TextField-BucTJljM.js";import{M as $}from"./MenuItem-B4ZcixFb.js";import{D as M}from"./DatePicker-CwwrX_FD.js";import"./DialogContent-mFzB5_Mx.js";import"./Modal-CwWs3I4F.js";import"./Slide-DtdTJVKu.js";import"./Edit-CwExJUNw.js";import"./Save-Cbz7BGnc.js";import"./Search-CyrNpi08.js";import"./isHostComponent-Byq13FOA.js";import"./KeyboardArrowRight-B2v7g9ly.js";import"./InputBase-BjWt6y8l.js";import"./Toolbar-Dy84SFcE.js";import"./Visibility-CFzAd-gA.js";import"./reselect-chQN1zS_.js";import"./Menu-4fDYuzS_.js";import"./List-Bn0p357_.js";import"./ListItemText-D64mH7rW.js";import"./listItemTextClasses-D33cD7Dv.js";import"./InputAdornment-B1la7Cdg.js";import"./Checkbox-CqLXZ7o-.js";import"./SwitchBase-eVy0UzNH.js";import"./FormControlLabel-DoYbMEM9.js";import"./LinearProgress-CCvmoNmW.js";import"./CircularProgress-C-K4l3j0.js";import"./useMediaQuery-2gABoogz.js";import"./ListItem-jOw138fS.js";const ge=a=>async n=>{var d,p;try{const h=J(a);n(K());const c=await I.getStudents(h);n(V(c.data.data))}catch(h){C.error(((p=(d=h.response)==null?void 0:d.data)==null?void 0:p.data)||"Failed to fetch students",{autoClose:3e3})}},Se=a=>async n=>{try{n(de());const d=await I.getStudentById(a);n(le(d.data.data))}catch(d){C.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},je=a=>async n=>{try{n(se());const d=await I.createStudent(a);return n(ne(d.data.data)),d.data}catch(d){C.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},Ce=a=>async n=>{try{n(re());const d=await I.updateStudent(a,a._id);return n(ae(d.data.data)),d.data}catch(d){C.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},ye=a=>async n=>{try{n(ee());const d=await I.deleteStudent(a);n(te(a)),C.info(d.message||"Student deleted successfully",{autoClose:3e3})}catch(d){console.log(d),C.error(d.response.data.data||"Failed to fetch student",{autoClose:3e3})}},v={fetchStudents:ge,fetchStudentById:Se,createStudents:je,updateStudents:Ce,deleteStudents:ye},De=({initialValues:a,onSubmit:n,onClose:d})=>{var B;const{data:p}=O(t=>t.user),{data:h}=O(t=>t.organization),c=(B=p==null?void 0:p.users)==null?void 0:B.filter(t=>t.role==="STUDENT"),x=h==null?void 0:h.organizations,A={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",enrolledCoursesIds:[],currentClassId:"",dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:y,formState:{errors:s},reset:D}=fe({defaultValues:A});S.useEffect(()=>{a&&D({...a,dateOfBirth:a.dateOfBirth?w(a.dateOfBirth):null,createdAt:a.createdAt?w(a.createdAt):null,updatedAt:a.updatedAt?w(a.updatedAt):null})},[a,D]);const T=t=>{const r={...t,dateOfBirth:t.dateOfBirth?t.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:t.createdAt?t.createdAt.format("YYYY-MM-DD"):null,updatedAt:t.updatedAt?t.updatedAt.format("YYYY-MM-DD"):null};n(r)};return e.jsx("form",{onSubmit:y(T),children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:t})=>{var r;return e.jsxs(R,{fullWidth:!0,margin:"normal",error:!!s.userId,children:[e.jsx(_,{children:"User ID"}),e.jsx(z,{...t,label:"User ID",renderValue:l=>{var f;return e.jsx(Y,{variant:"body2",children:(f=c==null?void 0:c.find(j=>j._id===l))==null?void 0:f.username})},children:c==null?void 0:c.map(l=>e.jsx($,{value:l._id,children:l.username},l._id))}),e.jsx(U,{children:(r=s.userId)==null?void 0:r.message})]})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"name",control:i,rules:{required:"Name is required"},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Name",fullWidth:!0,margin:"normal",error:!!s.name,helperText:(r=s.name)==null?void 0:r.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!s.phone,helperText:(r=s.phone)==null?void 0:r.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Email",fullWidth:!0,margin:"normal",error:!!s.email,helperText:(r=s.email)==null?void 0:r.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!s.phone,helperText:(r=s.phone)==null?void 0:r.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:t})=>{var r;return e.jsxs(R,{fullWidth:!0,margin:"normal",error:!!s.organizationId,children:[e.jsx(_,{children:"Organization"}),e.jsx(z,{...t,label:"Organization",renderValue:l=>e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(f=>{var j;return e.jsx(Y,{component:"span",variant:"body2",children:(j=x==null?void 0:x.find(P=>P.id===f))==null?void 0:j.name},f)})}),children:x==null?void 0:x.map(l=>e.jsx($,{value:l.id,children:l.name},l.id))}),e.jsx(U,{children:(r=s.organizationId)==null?void 0:r.message})]})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"currentClassId",control:i,rules:{required:"Current Class is required"},render:({field:t})=>{var r;return e.jsx(g,{...t,label:"Current Class",fullWidth:!0,margin:"normal",error:!!s.currentClassId,helperText:(r=s.currentClassId)==null?void 0:r.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"dateOfBirth",control:i,render:({field:t})=>{var r;return e.jsx(M,{label:"Date of Birth",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.dateOfBirth,helperText:(r=s.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"address",control:i,render:({field:{onChange:t,value:r}})=>{var l;return e.jsx(g,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:t,error:!!s.address,helperText:(l=s.address)==null?void 0:l.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"email",control:i,render:({field:{onChange:t,value:r}})=>{var l;return e.jsx(g,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:t,error:!!s.email,helperText:(l=s.email)==null?void 0:l.message})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"enrollmentDate",control:i,render:({field:t})=>{var r;return e.jsx(M,{label:"Enrollment Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.enrollmentDate,helperText:(r=s.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(m,{name:"graduationDate",control:i,render:({field:t})=>{var r;return e.jsx(M,{label:"Graduation Date",value:t.value,onChange:l=>t.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!s.graduationDate,helperText:(r=s.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(E,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(q,{variant:"outlined",color:"primary",onClick:()=>{D(A),d()},children:"Cancel"}),e.jsx(q,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function tt(){const a=oe(),n=O(o=>o.student.data),d=ie(),p=ue().id!==void 0,h=S.useMemo(()=>[{field:"name",headerName:"Student Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"enrolledCoursesIds",headerName:"Enrolled Courses Count",flex:1,editable:!0,headerClassName:"theme--header",renderCell:o=>Array.isArray(o.value)?o.value.length:""},{field:"dateOfBirth",headerName:"Date Of Birth",flex:1,editable:!1,headerClassName:"theme--header",renderCell:o=>{if(!o.value)return"";const b=new Date(o.value),N=String(b.getDate()).padStart(2,"0"),H=String(b.getMonth()+1).padStart(2,"0"),X=b.getFullYear();return`${N}/${H}/${X}`}}],[]),[c,x]=S.useState({}),[A,i]=S.useState(""),[y,s]=S.useState(null),[D,T]=S.useState(!1),{loading:B}=O(o=>o.student),t=S.useCallback(o=>{a(v.fetchStudents(o))},[a]),{params:r,setParams:l}=pe({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},t),f=o=>{l(o)},j=()=>{s(null),i("Add Student"),W()},P=o=>{const b=n==null?void 0:n.students.find(N=>N._id===o);s(b||null),i("Edit Student"),W()},G=async o=>{a(v.deleteStudents(o))},k=async o=>{a(y?v.updateStudents({...o,_id:y._id}):v.createStudents(o)),F()},Z=()=>{a(v.fetchStudents(r))},W=()=>T(!0),F=()=>T(!1),L=o=>{d(ce.STUDENT_PROFILE.replace(":id",o))},Q=(n==null?void 0:n.totalStudents)||0;return e.jsx(E,{sx:{width:"100%",height:"100%"},children:p?e.jsx(me,{}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{columns:h,onAdd:j,onDelete:G,onEdit:P,rows:(n==null?void 0:n.students)??[],rowModesModel:c,setRowModesModel:x,loading:B,reloadData:Z,totalRows:Q,paginationModel:{page:r.page-1,pageSize:r.limit},onParamsChange:o=>f(o),onView:L}),e.jsx(he,{open:D,onClose:F,title:A,children:e.jsx(De,{initialValues:y,onSubmit:k,onClose:F})})]})})}export{tt as default};
