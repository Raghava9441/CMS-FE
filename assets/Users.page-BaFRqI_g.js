import{h as k,r as f,L as F,j as e,M as j,B as W,T as z,N as Y,J as w,O as A}from"./index-DgQHWWw6.js";import G from"./GenericModal-DF_-oMZU.js";import{u as _,C as n}from"./index.esm-QTyF_s8d.js";import{G as t}from"./Grid-CdZ8gNQp.js";import{T as p,F as S,I as C,S as T,a as y}from"./TextField-Bpx2TdiV.js";import{D as $}from"./DatePicker-lc64QBH_.js";import{F as Z}from"./FormControlLabel-BL9PB2Z2.js";import{S as H}from"./Switch-DMbARcGf.js";import{u as J,R as K}from"./usePaginationParams-DwnLzO8u.js";import"./DialogContent-Cj2U3tyN.js";import"./useFormControl-cjLqdzgI.js";import"./InputBase-6s9B2OtX.js";import"./InputAdornment-BcV2iJv_.js";import"./SwitchBase-BiStZX0Z.js";import"./Save-Dx3sa6bc.js";import"./reselect-CSPtcQt5.js";import"./Checkbox-B9rZYL3U.js";import"./KeyboardArrowRight-DGxqdYri.js";import"./TableCell-C9jJLafw.js";import"./CircularProgress-D4KD0uhr.js";import"./Person-DAqrzjRN.js";const Q=({initialValues:i,onSubmit:U,onClose:N})=>{var m;const{data:b}=k(r=>r.organization),c=(m=b==null?void 0:b.organizations)==null?void 0:m.map(r=>({id:r._id,name:r.name})),g={_id:"",organizations:c||[],organizationId:c?c[0].id:"",username:"",email:"",fullname:"",avatar:"",coverImage:"",age:"",role:"STUDENT",gender:"male",phone:"",address:{street:"",city:"",state:"",zip:"",country:""},status:"active",dateOfBirth:null,biography:"",permissions:[],socialLinks:{facebook:"",twitter:"",linkedin:"",instagram:""},preferences:{notifications:!0,language:"en",theme:"light",timezone:"Asia/Kolkata",currency:"INR",dateFormat:"DD/MM/YYYY"},createdAt:null,updatedAt:null},{control:l,handleSubmit:D,formState:{errors:a},reset:v}=_({defaultValues:g});f.useEffect(()=>{i&&v({...i,dateOfBirth:i.dateOfBirth?F(i.dateOfBirth):null,createdAt:i.createdAt?F(i.createdAt):null,updatedAt:i.updatedAt?F(i.updatedAt):null})},[i,v]);const M=r=>{const s={...r,dateOfBirth:r.dateOfBirth?r.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:r.createdAt?r.createdAt.format("YYYY-MM-DD"):null,updatedAt:r.updatedAt?r.updatedAt.format("YYYY-MM-DD"):null,organizations:r.organizations,organizationId:r.organizations?r.organizations[0].id:""};U(s)};return e.jsx("form",{onSubmit:D(M),children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"username",control:l,rules:{required:"Username is required"},render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Username",size:"small",fullWidth:!0,margin:"normal",error:!!a.username,helperText:(s=a.username)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"fullname",control:l,rules:{required:"Full name is required"},render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Full Name",size:"small",fullWidth:!0,margin:"normal",error:!!a.fullname,helperText:(s=a.fullname)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(n,{name:"organizations",control:l,rules:{required:"At least one organization is required"},render:({field:r})=>{var s;return e.jsxs(S,{fullWidth:!0,margin:"normal",error:!!a.organizations,children:[e.jsx(C,{children:"Organizations"}),e.jsx(T,{...r,multiple:!0,label:"Organizations",size:"small",renderValue:o=>e.jsx(W,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o.map(u=>{var h;return e.jsx(z,{component:"span",variant:"body2",children:(h=c==null?void 0:c.find(x=>x.id===u))==null?void 0:h.name},u)})}),children:c==null?void 0:c.map(o=>e.jsx(j,{value:o.id,children:o.name},o.id))}),e.jsx(y,{children:(s=a.organizations)==null?void 0:s.message})]})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"email",size:"small",control:l,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Email",size:"small",fullWidth:!0,margin:"normal",error:!!a.email,helperText:(s=a.email)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"age",control:l,rules:{required:"Age is required",pattern:{value:/^[0-9]+$/,message:"Age must be a number"}},render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Age",size:"small",fullWidth:!0,margin:"normal",error:!!a.age,helperText:(s=a.age)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"role",control:l,rules:{required:"Role is required"},render:({field:r})=>{var s;return e.jsxs(S,{fullWidth:!0,margin:"normal",error:!!a.role,size:"small",children:[e.jsx(C,{children:"Role"}),e.jsxs(T,{...r,label:"Role",children:[e.jsx(j,{value:"ADMIN",children:"Admin"}),e.jsx(j,{value:"TEACHER",children:"Teacher"}),e.jsx(j,{value:"STUDENT",children:"Student"}),e.jsx(j,{value:"PARENT",children:"Parent"})]}),e.jsx(y,{children:(s=a.role)==null?void 0:s.message})]})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"gender",control:l,rules:{required:"Gender is required"},render:({field:r})=>{var s;return e.jsxs(S,{fullWidth:!0,margin:"normal",error:!!a.gender,size:"small",children:[e.jsx(C,{children:"Gender"}),e.jsxs(T,{...r,label:"Gender",children:[e.jsx(j,{value:"male",children:"Male"}),e.jsx(j,{value:"female",children:"Female"}),e.jsx(j,{value:"other",children:"Other"})]}),e.jsx(y,{children:(s=a.gender)==null?void 0:s.message})]})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"phone",control:l,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Phone",size:"small",fullWidth:!0,margin:"normal",error:!!a.phone,helperText:(s=a.phone)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"avatar",control:l,render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Avatar URL",size:"small",fullWidth:!0,margin:"normal",error:!!a.avatar,helperText:(s=a.avatar)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"coverImage",control:l,render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Cover Image URL",size:"small",fullWidth:!0,margin:"normal",error:!!a.coverImage,helperText:(s=a.coverImage)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"dateOfBirth",control:l,render:({field:r})=>{var s;return e.jsx($,{label:"Date of Birth",value:r.value,onChange:o=>r.onChange(o),slotProps:{textField:{size:"small",fullWidth:!0,error:!!a.dateOfBirth,helperText:(s=a.dateOfBirth)==null?void 0:s.message}}})}})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"status",control:l,render:({field:r})=>{var s;return e.jsxs(S,{fullWidth:!0,margin:"normal",error:!!a.status,size:"small",children:[e.jsx(C,{children:"Status"}),e.jsxs(T,{...r,label:"Status",children:[e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"inactive",children:"Inactive"})]}),e.jsx(y,{children:(s=a.status)==null?void 0:s.message})]})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(n,{name:"biography",control:l,render:({field:r})=>{var s;return e.jsx(p,{...r,label:"Biography",fullWidth:!0,multiline:!0,rows:4,margin:"normal",error:!!a.biography,helperText:(s=a.biography)==null?void 0:s.message})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(z,{variant:"h6",children:"Address"})}),["street","city","state","zip","country"].map(r=>e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:`address.${r}`,control:l,render:({field:{onChange:s,value:o}})=>{var u,h,x;return e.jsx(p,{label:r.charAt(0).toUpperCase()+r.slice(1),fullWidth:!0,margin:"normal",size:"small",value:o,onChange:s,error:!!((u=a.address)!=null&&u[r]),helperText:(x=(h=a.address)==null?void 0:h[r])==null?void 0:x.message})}})},r)),e.jsx(t,{item:!0,xs:12,children:e.jsx(z,{variant:"h6",children:"Social Links"})}),["facebook","twitter","linkedin","instagram"].map(r=>e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:`socialLinks.${r}`,control:l,render:({field:{onChange:s,value:o}})=>{var u,h,x;return e.jsx(p,{label:r.charAt(0).toUpperCase()+r.slice(1),fullWidth:!0,margin:"normal",size:"small",value:o,onChange:s,error:!!((u=a.socialLinks)!=null&&u[r]),helperText:(x=(h=a.socialLinks)==null?void 0:h[r])==null?void 0:x.message})}})},r)),e.jsx(t,{item:!0,xs:12,children:e.jsx(z,{variant:"h6",children:"Preferences"})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:"preferences.notifications",control:l,render:({field:{onChange:r,value:s}})=>e.jsx(Z,{control:e.jsx(H,{checked:s,onChange:r,color:"primary"}),label:"Notifications"})})}),["language","theme","timezone","currency","dateFormat"].map(r=>e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(n,{name:`preferences.${r}`,control:l,render:({field:{onChange:s,value:o}})=>{var u,h,x;return e.jsx(p,{label:r.charAt(0).toUpperCase()+r.slice(1),fullWidth:!0,margin:"normal",size:"small",value:o,onChange:s,error:!!((u=a.preferences)!=null&&u[r]),helperText:(x=(h=a.preferences)==null?void 0:h[r])==null?void 0:x.message})}})},r)),e.jsx(t,{item:!0,xs:12,children:e.jsxs(W,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(Y,{variant:"outlined",color:"primary",onClick:()=>{v(g),N()},children:"Cancel"}),e.jsx(Y,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function be(){const i=w(),[U,N]=f.useState({}),[b,c]=f.useState(""),[g,l]=f.useState(null),[D,a]=f.useState(!1),v=f.useMemo(()=>[{field:"username",headerName:"Username",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"fullname",headerName:"Full Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"role",headerName:"Role",flex:1,editable:!0,headerClassName:"theme--header"},{field:"gender",headerName:"Gender",flex:1,editable:!0,headerClassName:"theme--header"},{field:"status",headerName:"Status",flex:1,editable:!0,headerClassName:"theme--header"}],[]),{loading:M,data:m}=k(d=>d.user),r=f.useCallback(d=>{i(A.fetchUsers(d))},[i]),{params:s,setParams:o}=J({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},r),u=d=>{o(d),console.log(d)},h=()=>{l(null),c("Add User"),B()},x=d=>{const P=m==null?void 0:m.users.find(L=>L._id===d);l(P||null),c("Edit User"),B()},I=d=>{i(A.deleteUser(d))},R=async d=>{g!=null&&g._id?i(A.updateUser({...d,_id:g._id})):i(A.createUser(d)),O()},q=()=>{i(A.fetchUsers(s))},B=()=>a(!0),O=()=>a(!1),E=(m==null?void 0:m.totalUsers)||0;return m!=null&&m.users,e.jsxs(W,{sx:{height:"100%"},children:[e.jsx(K,{columns:v,onAdd:h,onEdit:x,onDelete:I,rows:(m==null?void 0:m.users)||[],rowModesModel:U,setRowModesModel:N,loading:M,reloadData:q,totalRows:E,paginationModel:{page:s.page-1,pageSize:s.limit},onParamsChange:d=>u(d),enableSearch:!0,enableFilters:!0,enableSorting:!0,searchPlaceholder:"Search users...",pageSizeOptions:[5,10,25,50,100]}),e.jsx(G,{open:D,onClose:O,title:b,children:e.jsx(Q,{initialValues:g,onSubmit:R,onClose:O})})]})}export{be as default};
//# sourceMappingURL=Users.page-BaFRqI_g.js.map
