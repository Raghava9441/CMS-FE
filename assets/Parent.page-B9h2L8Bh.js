import{p as $,ak as L,al as I,am as H,v as C,an as J,ao as Q,ap as K,aq as X,ar as V,as as ee,at as ae,au as te,h as S,r as g,L as B,j as e,M as F,T as z,B as M,N as _,J as re}from"./index-B6Q5p1mB.js";import{u as ne,R as se}from"./usePaginationParams-BufhDkfw.js";import de from"./GenericModal-lxnmMOUT.js";import{u as le,C as c}from"./index.esm-BWg4JeyN.js";import{G as m}from"./Grid-BZIlOCxN.js";import{F as q,I as W,S as Y,a as R,T as y}from"./TextField-CqXArht2.js";import{D as O}from"./DatePicker-kGeQ5F1d.js";import"./Save-BBcKUFz4.js";import"./reselect-C7xKFEgn.js";import"./InputBase-DvqLZ0SM.js";import"./useFormControl-BFweTqSu.js";import"./InputAdornment-BOLYg3Uk.js";import"./Checkbox-BMGwJpsF.js";import"./SwitchBase-BDBXzfmE.js";import"./FormControlLabel-Dlj7SghN.js";import"./KeyboardArrowRight-B3CRtIMa.js";import"./TableCell-CnYRmD86.js";import"./CircularProgress-BiVxsZzW.js";import"./DialogContent-ITkyIvN5.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="64a1ccad-cbdc-4aa0-84cb-afa5158d3017",t._sentryDebugIdIdentifier="sentry-dbid-64a1ccad-cbdc-4aa0-84cb-afa5158d3017")}catch{}const oe=t=>async n=>{var s,f;try{const h=$(t);n(L());const u=await I.getParents(h);n(H(u.data.data))}catch(h){C.error(((f=(s=h.response)==null?void 0:s.data)==null?void 0:f.data)||"Failed to fetch organizations",{autoClose:3e3})}},ie=t=>async n=>{try{n(ae());const s=await I.getParentById(t);n(te(s.data.data))}catch(s){C.error(s.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},me=t=>async n=>{try{n(V());const s=await I.createParent(t);return n(ee(s.data.data)),s.data}catch(s){C.error(s.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ce=t=>async n=>{try{if(n(K()),t._id){const s=await I.updateParent(t,t._id);return n(X(s.data.data)),s.data}else throw new Error("Teacher ID is required for update")}catch(s){s instanceof Error&&C.error(s.message||"Failed to fetch organization",{autoClose:3e3})}},ue=t=>async n=>{try{n(J());const s=await I.deleteParent(t);n(Q(t)),C.info(s.message||"Organization deleted successfully",{autoClose:3e3})}catch(s){console.log(s),C.error(s.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},A={fetchParents:oe,fetchParentById:ie,createParents:me,updateParents:ce,deleteParents:ue},he=({initialValues:t,onSubmit:n,onClose:s})=>{var P;const{data:f}=S(a=>a.user),{data:h}=S(a=>a.organization),u=(P=f==null?void 0:f.users)==null?void 0:P.filter(a=>a.role==="PARENT"),p=h==null?void 0:h.organizations,j={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",childrenIds:[],dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:v,formState:{errors:d},reset:D}=le({defaultValues:j});g.useEffect(()=>{t&&D({...t,dateOfBirth:t.dateOfBirth?B(t.dateOfBirth):null,createdAt:t.createdAt?B(t.createdAt):null,updatedAt:t.updatedAt?B(t.updatedAt):null})},[t,D]);const T=a=>{const r={...a,dateOfBirth:a.dateOfBirth?a.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:a.createdAt?a.createdAt.format("YYYY-MM-DD"):null,updatedAt:a.updatedAt?a.updatedAt.format("YYYY-MM-DD"):null};n(r)};return e.jsx("form",{onSubmit:v(T),children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:a})=>{var r;return e.jsxs(q,{fullWidth:!0,margin:"normal",error:!!d.userId,children:[e.jsx(W,{children:"User ID"}),e.jsx(Y,{...a,label:"User ID",renderValue:l=>{var x;return e.jsx(z,{variant:"body2",children:(x=u==null?void 0:u.find(b=>b._id===l))==null?void 0:x.username})},children:u==null?void 0:u.map(l=>e.jsx(F,{value:l._id,children:l.username},l._id))}),e.jsx(R,{children:(r=d.userId)==null?void 0:r.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"name",control:i,rules:{required:"Name is required"},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Name",fullWidth:!0,margin:"normal",error:!!d.name,helperText:(r=d.name)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!d.phone,helperText:(r=d.phone)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Email",fullWidth:!0,margin:"normal",error:!!d.email,helperText:(r=d.email)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!d.phone,helperText:(r=d.phone)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:a})=>{var r;return e.jsxs(q,{fullWidth:!0,margin:"normal",error:!!d.organizationId,children:[e.jsx(W,{children:"Organization"}),e.jsx(Y,{...a,label:"Organization",renderValue:l=>e.jsx(M,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(x=>{var b;return e.jsx(z,{component:"span",variant:"body2",children:(b=p==null?void 0:p.find(N=>N.id===x))==null?void 0:b.name},x)})}),children:p==null?void 0:p.map(l=>e.jsx(F,{value:l.id,children:l.name},l.id))}),e.jsx(R,{children:(r=d.organizationId)==null?void 0:r.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"dateOfBirth",control:i,render:({field:a})=>{var r;return e.jsx(O,{label:"Date of Birth",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!d.dateOfBirth,helperText:(r=d.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"address",control:i,render:({field:{onChange:a,value:r}})=>{var l;return e.jsx(y,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!d.address,helperText:(l=d.address)==null?void 0:l.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,render:({field:{onChange:a,value:r}})=>{var l;return e.jsx(y,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!d.email,helperText:(l=d.email)==null?void 0:l.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"enrollmentDate",control:i,render:({field:a})=>{var r;return e.jsx(O,{label:"Enrollment Date",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!d.enrollmentDate,helperText:(r=d.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"graduationDate",control:i,render:({field:a})=>{var r;return e.jsx(O,{label:"Graduation Date",value:a.value,onChange:l=>a.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!d.graduationDate,helperText:(r=d.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(M,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(_,{variant:"outlined",color:"primary",onClick:()=>{D(j),s()},children:"Cancel"}),e.jsx(_,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function Me(){const t=re(),n=S(o=>o.parent.data),s=g.useMemo(()=>[{field:"name",headerName:"Parent Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"occupation",headerName:"Occupation",flex:1,editable:!0,headerClassName:"theme--header"},{field:"relationshipToStudent",headerName:"Relationship to Student",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[f,h]=g.useState({}),[u,p]=g.useState(""),[j,i]=g.useState(null),[v,d]=g.useState(!1),{loading:D}=S(o=>o.parent),T=g.useCallback(o=>{t(A.fetchParents(o))},[t]),{params:P,setParams:a}=ne({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},T),r=o=>{a(o)},l=()=>{i(null),p("Add Parent"),E()},x=o=>{const U=n==null?void 0:n.parents.find(Z=>Z._id===o);i(U||null),p("Edit Parent"),E()},b=async o=>{t(A.deleteParents(o))},N=async o=>{t(j?A.updateParents({...o,_id:j._id}):A.createParents(o)),w()},k=()=>{t(A.fetchParents(P))},E=()=>d(!0),w=()=>d(!1),G=(n==null?void 0:n.totalParents)||0;return e.jsxs(M,{sx:{width:"100%",height:"100%"},children:[e.jsx(se,{columns:s,onAdd:l,onDelete:b,onEdit:x,rows:(n==null?void 0:n.parents)??[],rowModesModel:f,setRowModesModel:h,loading:D,reloadData:k,totalRows:G,paginationModel:{page:P.page-1,pageSize:P.limit},onParamsChange:o=>r(o)}),e.jsx(de,{open:v,onClose:w,title:u,children:e.jsx(he,{initialValues:j,onSubmit:N,onClose:w})})]})}export{Me as default};
//# sourceMappingURL=Parent.page-B9h2L8Bh.js.map
