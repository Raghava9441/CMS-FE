import{p,b4 as h,b5 as i,b6 as f,v as o,b7 as b,b8 as B,b9 as P,ba as w,bb as x,bc as N,bd as E,be as V,bf as $,bg as G,bh as O,bi as _,bj as z,bk as J,bl as Q,bm as T,J as Y,h as k,r as C,j as S,B as H}from"./index-DgQHWWw6.js";import{u as K,R as L}from"./usePaginationParams-DwnLzO8u.js";import"./Save-Dx3sa6bc.js";import"./reselect-CSPtcQt5.js";import"./InputBase-6s9B2OtX.js";import"./useFormControl-cjLqdzgI.js";import"./TextField-Bpx2TdiV.js";import"./InputAdornment-BcV2iJv_.js";import"./Checkbox-B9rZYL3U.js";import"./SwitchBase-BiStZX0Z.js";import"./FormControlLabel-BL9PB2Z2.js";import"./KeyboardArrowRight-DGxqdYri.js";import"./TableCell-C9jJLafw.js";import"./CircularProgress-D4KD0uhr.js";import"./Person-DAqrzjRN.js";const U=c=>async t=>{var a,s,d,n;try{const e=p(c);t(h());const r=await i.getAttendances(e),l={...r.data.data,attendances:m(r.data.data.attendances)};t(f(l))}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to fetch attendances",{autoClose:3e3}),t(b(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to fetch attendances"))}},W=c=>async t=>{var a,s,d,n;try{t(J());const e=await i.getAttendanceById(c),r={...e.data.data,attendances:m(e.data.data.attendances)};t(Q(r))}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to fetch attendance",{autoClose:3e3}),t(T(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to fetch attendance"))}},X=c=>async t=>{var a,s,d,n;try{t(O());const e=await i.createAttendance(c),r={...e.data.data,attendances:m(e.data.data.attendances)};return t(_(r)),o.success("Attendance created successfully",{autoClose:3e3}),e.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to create attendance",{autoClose:3e3}),t(z(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to create attendance"))}},Z=(c,t)=>async a=>{var s,d,n,e;try{a(V());const r=await i.updateAttendance(c,t),l={...r.data.data,attendances:m(r.data.data.attendances)};return a($(l)),o.success("Attendance updated successfully",{autoClose:3e3}),r.data}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to update attendance",{autoClose:3e3}),a(G(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to update attendance"))}},ee=c=>async t=>{var a,s,d,n;try{t(B()),await i.deleteAttendance(c),t(E(c)),o.success("Attendance deleted successfully",{autoClose:3e3})}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to delete attendance",{autoClose:3e3}),t(P(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to delete attendance"))}},te=(c,t)=>async a=>{var s,d,n,e;try{const r=p(t);a(h());const l=await i.getAttendanceByStudent(c,r),A={...l.data.data,attendances:m(l.data.data.attendances)};a(f(A))}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch student attendance",{autoClose:3e3}),a(b(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to fetch student attendance"))}},ae=(c,t)=>async a=>{var s,d,n,e;try{const r=p(t);a(h());const l=await i.getAttendanceByClass(c,r),A={...l.data.data,attendances:m(l.data.data.attendances)};a(f(A))}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch class attendance",{autoClose:3e3}),a(b(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to fetch class attendance"))}},ne=(c,t)=>async a=>{var s,d,n,e;try{const r=p(t);a(h());const l=await i.getAttendanceByDate(c,r),A={...l.data.data,attendances:m(l.data.data.attendances)};a(f(A))}catch(r){o.error(((d=(s=r.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch attendance by date",{autoClose:3e3}),a(b(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.data)||"Failed to fetch attendance by date"))}},se=(c,t)=>async a=>{var s,d;try{const n=p(t);a(h());const e=await i.getStudentAttendanceStats(c,n);return a(f({attendances:[],totalAttendances:0,limit:0,page:0,totalPages:0,serialNumberStartFrom:0,hasPrevPage:!1,hasNextPage:!1,prevPage:null,nextPage:null})),e.data}catch(n){o.error(((d=(s=n.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch student attendance stats",{autoClose:3e3})}},de=(c,t)=>async a=>{var s,d;try{const n=p(t);a(h());const e=await i.getClassAttendanceStats(c,n);return a(f({attendances:[],totalAttendances:0,limit:0,page:0,totalPages:0,serialNumberStartFrom:0,hasPrevPage:!1,hasNextPage:!1,prevPage:null,nextPage:null})),e.data}catch(n){o.error(((d=(s=n.response)==null?void 0:s.data)==null?void 0:d.data)||"Failed to fetch class attendance stats",{autoClose:3e3})}},re=c=>async t=>{var a,s,d,n;try{t(w());const e=await i.markBulkAttendance(c),r={...e.data.data,attendances:m(e.data.data.attendances)};return t(x(r)),o.success("Bulk attendance marked successfully",{autoClose:3e3}),e.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to mark bulk attendance",{autoClose:3e3}),t(N(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to mark bulk attendance"))}},ce=c=>async t=>{var a,s,d,n;try{t(w());const e=new FormData;e.append("file",c);const r=await i.createBulkAttendances(e),l={...r.data.data,attendances:m(r.data.data.attendances)};return t(x(l)),o.success("Bulk attendances created successfully",{autoClose:3e3}),r.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to create bulk attendances",{autoClose:3e3}),t(N(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to create bulk attendances"))}},oe=c=>async t=>{var a,s,d,n;try{t(B());const e=await i.deleteBulkAttendances(c),r={...e.data.data,attendances:m(e.data.data.attendances)};return t(f(r)),o.success("Bulk attendances deleted successfully",{autoClose:3e3}),e.data}catch(e){o.error(((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.data)||"Failed to delete bulk attendances",{autoClose:3e3}),t(P(((n=(d=e.response)==null?void 0:d.data)==null?void 0:n.data)||"Failed to delete bulk attendances"))}},m=c=>c?Array.isArray(c)?c.length>0&&Array.isArray(c[0])?c[0]:c:[c]:[],F={fetchAttendances:U,fetchAttendanceById:W,createAttendance:X,updateAttendance:Z,deleteAttendance:ee,getAttendanceByStudent:te,getAttendanceByClass:ae,getAttendanceByDate:ne,getStudentAttendanceStats:se,getClassAttendanceStats:de,markBulkAttendance:re,createBulkAttendances:ce,deleteBulkAttendances:oe};function Be(){const c=Y(),t=k(u=>u.attendance.data),{loading:a}=k(u=>u.attendance),s=C.useMemo(()=>[{field:"classId",headerName:"Class ID",flex:1,editable:!0,headerClassName:"theme--header"},{field:"studentId",headerName:"Student ID",flex:1,editable:!0,headerClassName:"theme--header"},{field:"date",headerName:"Date",flex:1,editable:!0,headerClassName:"theme--header",renderCell:u=>{if(!u.value)return"";const y=new Date(u.value),g=String(y.getDate()).padStart(2,"0"),R=String(y.getMonth()+1).padStart(2,"0"),j=y.getFullYear();return`${g}/${R}/${j}`}},{field:"status",headerName:"Status",flex:1,editable:!0,headerClassName:"theme--header",type:"singleSelect",valueOptions:["present","absent","excused"]},{field:"remarks",headerName:"Remarks",flex:1,editable:!0,headerClassName:"theme--header"},{field:"markedBy",headerName:"Marked By",flex:1,editable:!0,headerClassName:"theme--header"}],[]),[d,n]=C.useState({}),e=C.useCallback(u=>{c(F.fetchAttendances(u))},[c]),{params:r,setParams:l}=K({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},e),A=u=>{l(u)},v=()=>{console.log("Add attendance")},D=u=>{const y=t==null?void 0:t.attendances.find(g=>g._id===u);console.log("Edit attendance:",y)},I=async u=>{c(F.deleteAttendance(u))},M=u=>{const y=t==null?void 0:t.attendances.find(g=>g._id===u);console.log("View attendance:",y)},q=()=>{c(F.fetchAttendances(r))};return S.jsx(H,{sx:{flexGrow:1},children:S.jsx(L,{columns:s,rows:(t==null?void 0:t.attendances)||[],loading:a,onAdd:v,onEdit:D,onView:M,onDelete:I,rowModesModel:d,setRowModesModel:n,totalRows:(t==null?void 0:t.totalAttendances)||0,paginationModel:{page:r.page-1,pageSize:r.limit},onParamsChange:A,reloadData:q})})}export{Be as default};
//# sourceMappingURL=Attendance.page-BNBPiziI.js.map
