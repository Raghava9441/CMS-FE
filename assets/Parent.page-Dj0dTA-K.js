import{p as $,ak as L,al as S,am as H,v as b,an as J,ao as Q,ap as K,aq as X,ar as V,as as ee,at as ae,au as re,h as v,r as g,L as O,j as e,M as z,T as E,B as w,N as q,J as te}from"./index-R703-jZn.js";import{u as se,R as ne}from"./usePaginationParams-RhE3YGkD.js";import le from"./GenericModal-CI9EKe7h.js";import{u as oe,C as c}from"./index.esm-Brhin-EH.js";import{G as m}from"./Grid-DNVof5P2.js";import{F as W,I as Y,S as R,a as _,T as y}from"./TextField-DnDWyxTy.js";import{D as M}from"./DatePicker-BlfIytG2.js";import"./Save-DQXd9c0C.js";import"./reselect-B5WBFqaJ.js";import"./InputBase-lCwOyFCU.js";import"./useFormControl-CXpyBcMX.js";import"./InputAdornment-Dv0N28eP.js";import"./Checkbox-CZRmEr2R.js";import"./SwitchBase-D4fUKCtc.js";import"./FormControlLabel-D7wS11kJ.js";import"./KeyboardArrowRight-PT1jTHRk.js";import"./TableCell-DAW-rVix.js";import"./CircularProgress-DTH0MZKS.js";import"./DialogContent-Szz1wD6j.js";const de=t=>async s=>{var n,x;try{const h=$(t);s(L());const u=await S.getParents(h);s(H(u.data.data))}catch(h){b.error(((x=(n=h.response)==null?void 0:n.data)==null?void 0:x.data)||"Failed to fetch organizations",{autoClose:3e3})}},ie=t=>async s=>{try{s(ae());const n=await S.getParentById(t);s(re(n.data.data))}catch(n){b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},me=t=>async s=>{try{s(V());const n=await S.createParent(t);return s(ee(n.data.data)),n.data}catch(n){b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ce=t=>async s=>{try{if(s(K()),t._id){const n=await S.updateParent(t,t._id);return s(X(n.data.data)),n.data}else throw new Error("Teacher ID is required for update")}catch(n){n instanceof Error&&b.error(n.message||"Failed to fetch organization",{autoClose:3e3})}},ue=t=>async s=>{try{s(J());const n=await S.deleteParent(t);s(Q(t)),b.info(n.message||"Organization deleted successfully",{autoClose:3e3})}catch(n){console.log(n),b.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},A={fetchParents:de,fetchParentById:ie,createParents:me,updateParents:ce,deleteParents:ue},he=({initialValues:t,onSubmit:s,onClose:n})=>{var P;const{data:x}=v(a=>a.user),{data:h}=v(a=>a.organization),u=(P=x==null?void 0:x.users)==null?void 0:P.filter(a=>a.role==="PARENT"),p=h==null?void 0:h.organizations,j={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",childrenIds:[],dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:I,formState:{errors:l},reset:D}=oe({defaultValues:j});g.useEffect(()=>{t&&D({...t,dateOfBirth:t.dateOfBirth?O(t.dateOfBirth):null,createdAt:t.createdAt?O(t.createdAt):null,updatedAt:t.updatedAt?O(t.updatedAt):null})},[t,D]);const N=a=>{const r={...a,dateOfBirth:a.dateOfBirth?a.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:a.createdAt?a.createdAt.format("YYYY-MM-DD"):null,updatedAt:a.updatedAt?a.updatedAt.format("YYYY-MM-DD"):null};s(r)};return e.jsx("form",{onSubmit:I(N),children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:a})=>{var r;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!l.userId,children:[e.jsx(Y,{children:"User ID"}),e.jsx(R,{...a,label:"User ID",renderValue:o=>{var f;return e.jsx(E,{variant:"body2",children:(f=u==null?void 0:u.find(C=>C._id===o))==null?void 0:f.username})},children:u==null?void 0:u.map(o=>e.jsx(z,{value:o._id,children:o.username},o._id))}),e.jsx(_,{children:(r=l.userId)==null?void 0:r.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"name",control:i,rules:{required:"Name is required"},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Name",fullWidth:!0,margin:"normal",error:!!l.name,helperText:(r=l.name)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!l.phone,helperText:(r=l.phone)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Email",fullWidth:!0,margin:"normal",error:!!l.email,helperText:(r=l.email)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:a})=>{var r;return e.jsx(y,{...a,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!l.phone,helperText:(r=l.phone)==null?void 0:r.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:a})=>{var r;return e.jsxs(W,{fullWidth:!0,margin:"normal",error:!!l.organizationId,children:[e.jsx(Y,{children:"Organization"}),e.jsx(R,{...a,label:"Organization",renderValue:o=>e.jsx(w,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o.map(f=>{var C;return e.jsx(E,{component:"span",variant:"body2",children:(C=p==null?void 0:p.find(B=>B.id===f))==null?void 0:C.name},f)})}),children:p==null?void 0:p.map(o=>e.jsx(z,{value:o.id,children:o.name},o.id))}),e.jsx(_,{children:(r=l.organizationId)==null?void 0:r.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"dateOfBirth",control:i,render:({field:a})=>{var r;return e.jsx(M,{label:"Date of Birth",value:a.value,onChange:o=>a.onChange(o),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!l.dateOfBirth,helperText:(r=l.dateOfBirth)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"address",control:i,render:({field:{onChange:a,value:r}})=>{var o;return e.jsx(y,{label:"Address",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!l.address,helperText:(o=l.address)==null?void 0:o.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,render:({field:{onChange:a,value:r}})=>{var o;return e.jsx(y,{label:"Email",fullWidth:!0,margin:"normal",value:r,onChange:a,error:!!l.email,helperText:(o=l.email)==null?void 0:o.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"enrollmentDate",control:i,render:({field:a})=>{var r;return e.jsx(M,{label:"Enrollment Date",value:a.value,onChange:o=>a.onChange(o),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!l.enrollmentDate,helperText:(r=l.enrollmentDate)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"graduationDate",control:i,render:({field:a})=>{var r;return e.jsx(M,{label:"Graduation Date",value:a.value,onChange:o=>a.onChange(o),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!l.graduationDate,helperText:(r=l.graduationDate)==null?void 0:r.message}}})}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(q,{variant:"outlined",color:"primary",onClick:()=>{D(j),n()},children:"Cancel"}),e.jsx(q,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function we(){const t=te(),s=v(d=>d.parent.data),n=g.useMemo(()=>[{field:"name",headerName:"Parent Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"occupation",headerName:"Occupation",flex:1,editable:!0,headerClassName:"theme--header"},{field:"relationshipToStudent",headerName:"Relationship to Student",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[x,h]=g.useState({}),[u,p]=g.useState(""),[j,i]=g.useState(null),[I,l]=g.useState(!1),{loading:D}=v(d=>d.parent),N=g.useCallback(d=>{t(A.fetchParents(d))},[t]),{params:P,setParams:a}=se({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},N),r=d=>{a(d)},o=()=>{i(null),p("Add Parent"),F()},f=d=>{const U=s==null?void 0:s.parents.find(Z=>Z._id===d);i(U||null),p("Edit Parent"),F()},C=async d=>{t(A.deleteParents(d))},B=async d=>{t(j?A.updateParents({...d,_id:j._id}):A.createParents(d)),T()},k=()=>{t(A.fetchParents(P))},F=()=>l(!0),T=()=>l(!1),G=(s==null?void 0:s.totalParents)||0;return e.jsxs(w,{sx:{width:"100%",height:"100%"},children:[e.jsx(ne,{columns:n,onAdd:o,onDelete:C,onEdit:f,rows:(s==null?void 0:s.parents)??[],rowModesModel:x,setRowModesModel:h,loading:D,reloadData:k,totalRows:G,paginationModel:{page:P.page-1,pageSize:P.limit},onParamsChange:d=>r(d)}),e.jsx(le,{open:I,onClose:T,title:u,children:e.jsx(he,{initialValues:j,onSubmit:B,onClose:T})})]})}export{we as default};
//# sourceMappingURL=Parent.page-Dj0dTA-K.js.map
