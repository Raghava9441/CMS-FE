import{p as Z,a$ as H,b0 as S,b1 as L,h as y,b2 as Q,b3 as J,b4 as K,b5 as X,b6 as V,b7 as ee,b8 as re,b9 as ae,u as I,r as g,d as O,j as e,T as z,B as w,a as E,b as te}from"./index-B_cqZJjc.js";import{u as se,R as ne}from"./usePaginationParams-CJmsz9yU.js";import oe from"./GenericModal-DRmTlWuR.js";import{u as le,C as c}from"./index.esm-Dp1cijLg.js";import{G as m}from"./Grid-CvVXWlm9.js";import{F as q,I as W,S as Y,a as R,T as C}from"./TextField-ClGj9etd.js";import{M as _}from"./MenuItem-B4_Mu9KU.js";import{D as M}from"./DatePicker-DnW__EfO.js";import"./Edit-kS102nZz.js";import"./Save-gzNur6WS.js";import"./Search-DHSeIu6K.js";import"./isHostComponent-DI6Zuu5e.js";import"./KeyboardArrowRight-D4fgx2v_.js";import"./InputBase-DZRnDgal.js";import"./Modal-Du6OQ6mG.js";import"./Toolbar-CGqPdFQv.js";import"./Visibility-C7dMWSp3.js";import"./reselect-chQN1zS_.js";import"./Menu-e_9qz1_v.js";import"./List-BPqtGCWZ.js";import"./ListItemText-CtyCBBH7.js";import"./listItemTextClasses-CDVTXtLO.js";import"./InputAdornment-DUdQhZFs.js";import"./Checkbox-2PS_Y14Y.js";import"./SwitchBase-TI0bsxNd.js";import"./FormControlLabel-BAAYPI9o.js";import"./LinearProgress-CV2szxl6.js";import"./CircularProgress-0PMFYM1C.js";import"./DialogContent-YmIWMa_G.js";import"./Slide-Ccc21anO.js";import"./useMediaQuery-B7d5C5rB.js";import"./ListItem-BODdqm9C.js";const de=t=>async s=>{var n,x;try{const h=Z(t);s(H());const u=await S.getParents(h);s(L(u.data.data))}catch(h){y.error(((x=(n=h.response)==null?void 0:n.data)==null?void 0:x.data)||"Failed to fetch organizations",{autoClose:3e3})}},ie=t=>async s=>{try{s(re());const n=await S.getParentById(t);s(ae(n.data.data))}catch(n){y.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},me=t=>async s=>{try{s(V());const n=await S.createParent(t);return s(ee(n.data.data)),n.data}catch(n){y.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},ce=t=>async s=>{try{if(s(K()),t._id){const n=await S.updateParent(t,t._id);return s(X(n.data.data)),n.data}else throw new Error("Teacher ID is required for update")}catch(n){n instanceof Error&&y.error(n.message||"Failed to fetch organization",{autoClose:3e3})}},ue=t=>async s=>{try{s(Q());const n=await S.deleteParent(t);s(J(t)),y.info(n.message||"Organization deleted successfully",{autoClose:3e3})}catch(n){console.log(n),y.error(n.response.data.data||"Failed to fetch organization",{autoClose:3e3})}},A={fetchParents:de,fetchParentById:ie,createParents:me,updateParents:ce,deleteParents:ue},he=({initialValues:t,onSubmit:s,onClose:n})=>{var P;const{data:x}=I(r=>r.user),{data:h}=I(r=>r.organization),u=(P=x==null?void 0:x.users)==null?void 0:P.filter(r=>r.role==="PARENT"),p=h==null?void 0:h.organizations,j={_id:"",userId:"",name:"",phone:"",email:"",organizationId:"",childrenIds:[],dateOfBirth:null,address:{street:"",city:"",state:"",zip:"",country:""},emergencyContacts:[],enrollmentDate:null,graduationDate:null,createdAt:null,updatedAt:null},{control:i,handleSubmit:v,formState:{errors:o},reset:D}=le({defaultValues:j});g.useEffect(()=>{t&&D({...t,dateOfBirth:t.dateOfBirth?O(t.dateOfBirth):null,createdAt:t.createdAt?O(t.createdAt):null,updatedAt:t.updatedAt?O(t.updatedAt):null})},[t,D]);const B=r=>{const a={...r,dateOfBirth:r.dateOfBirth?r.dateOfBirth.format("YYYY-MM-DD"):null,createdAt:r.createdAt?r.createdAt.format("YYYY-MM-DD"):null,updatedAt:r.updatedAt?r.updatedAt.format("YYYY-MM-DD"):null};s(a)};return e.jsx("form",{onSubmit:v(B),children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"userId",control:i,rules:{required:"User ID is required"},render:({field:r})=>{var a;return e.jsxs(q,{fullWidth:!0,margin:"normal",error:!!o.userId,children:[e.jsx(W,{children:"User ID"}),e.jsx(Y,{...r,label:"User ID",renderValue:l=>{var f;return e.jsx(z,{variant:"body2",children:(f=u==null?void 0:u.find(b=>b._id===l))==null?void 0:f.username})},children:u==null?void 0:u.map(l=>e.jsx(_,{value:l._id,children:l.username},l._id))}),e.jsx(R,{children:(a=o.userId)==null?void 0:a.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"name",control:i,rules:{required:"Name is required"},render:({field:r})=>{var a;return e.jsx(C,{...r,label:"Name",fullWidth:!0,margin:"normal",error:!!o.name,helperText:(a=o.name)==null?void 0:a.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:r})=>{var a;return e.jsx(C,{...r,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!o.phone,helperText:(a=o.phone)==null?void 0:a.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:r})=>{var a;return e.jsx(C,{...r,label:"Email",fullWidth:!0,margin:"normal",error:!!o.email,helperText:(a=o.email)==null?void 0:a.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"phone",control:i,rules:{pattern:{value:/^[0-9]{10}$/,message:"Invalid phone number"}},render:({field:r})=>{var a;return e.jsx(C,{...r,label:"Phone Number",fullWidth:!0,margin:"normal",error:!!o.phone,helperText:(a=o.phone)==null?void 0:a.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"organizationId",control:i,rules:{required:"Organization is required"},render:({field:r})=>{var a;return e.jsxs(q,{fullWidth:!0,margin:"normal",error:!!o.organizationId,children:[e.jsx(W,{children:"Organization"}),e.jsx(Y,{...r,label:"Organization",renderValue:l=>e.jsx(w,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(f=>{var b;return e.jsx(z,{component:"span",variant:"body2",children:(b=p==null?void 0:p.find(N=>N.id===f))==null?void 0:b.name},f)})}),children:p==null?void 0:p.map(l=>e.jsx(_,{value:l.id,children:l.name},l.id))}),e.jsx(R,{children:(a=o.organizationId)==null?void 0:a.message})]})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"dateOfBirth",control:i,render:({field:r})=>{var a;return e.jsx(M,{label:"Date of Birth",value:r.value,onChange:l=>r.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!o.dateOfBirth,helperText:(a=o.dateOfBirth)==null?void 0:a.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"address",control:i,render:({field:{onChange:r,value:a}})=>{var l;return e.jsx(C,{label:"Address",fullWidth:!0,margin:"normal",value:a,onChange:r,error:!!o.address,helperText:(l=o.address)==null?void 0:l.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"email",control:i,render:({field:{onChange:r,value:a}})=>{var l;return e.jsx(C,{label:"Email",fullWidth:!0,margin:"normal",value:a,onChange:r,error:!!o.email,helperText:(l=o.email)==null?void 0:l.message})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"enrollmentDate",control:i,render:({field:r})=>{var a;return e.jsx(M,{label:"Enrollment Date",value:r.value,onChange:l=>r.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!o.enrollmentDate,helperText:(a=o.enrollmentDate)==null?void 0:a.message}}})}})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(c,{name:"graduationDate",control:i,render:({field:r})=>{var a;return e.jsx(M,{label:"Graduation Date",value:r.value,onChange:l=>r.onChange(l),slotProps:{textField:{fullWidth:!0,margin:"normal",error:!!o.graduationDate,helperText:(a=o.graduationDate)==null?void 0:a.message}}})}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(E,{variant:"outlined",color:"primary",onClick:()=>{D(j),n()},children:"Cancel"}),e.jsx(E,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})})]})})};function Ze(){const t=te(),s=I(d=>d.parent.data),n=g.useMemo(()=>[{field:"name",headerName:"Parent Name",flex:1,editable:!0,headerClassName:"theme--header"},{field:"phone",headerName:"Contact Phone",flex:1,editable:!0,headerClassName:"theme--header"},{field:"email",headerName:"Email",flex:1,editable:!0,headerClassName:"theme--header"},{field:"occupation",headerName:"Occupation",flex:1,editable:!0,headerClassName:"theme--header"},{field:"relationshipToStudent",headerName:"Relationship to Student",flex:1,editable:!0,headerClassName:"theme--header"},{field:"createdAt",headerName:"Created At",flex:1,editable:!1,headerClassName:"theme--header"},{field:"updatedAt",headerName:"Updated At",flex:1,editable:!1,headerClassName:"theme--header"}],[]),[x,h]=g.useState({}),[u,p]=g.useState(""),[j,i]=g.useState(null),[v,o]=g.useState(!1),{loading:D}=I(d=>d.parent),B=g.useCallback(d=>{t(A.fetchParents(d))},[t]),{params:P,setParams:r}=se({page:1,limit:10,sortBy:void 0,sortOrder:void 0,searchTerm:void 0,filters:{}},B),a=d=>{r(d)},l=()=>{i(null),p("Add Parent"),F()},f=d=>{const U=s==null?void 0:s.parents.find($=>$._id===d);i(U||null),p("Edit Parent"),F()},b=async d=>{t(A.deleteParents(d))},N=async d=>{t(j?A.updateParents({...d,_id:j._id}):A.createParents(d)),T()},G=()=>{t(A.fetchParents(P))},F=()=>o(!0),T=()=>o(!1),k=(s==null?void 0:s.totalParents)||0;return e.jsxs(w,{sx:{width:"100%",height:"100%"},children:[e.jsx(ne,{columns:n,onAdd:l,onDelete:b,onEdit:f,rows:(s==null?void 0:s.parents)??[],rowModesModel:x,setRowModesModel:h,loading:D,reloadData:G,totalRows:k,paginationModel:{page:P.page-1,pageSize:P.limit},onParamsChange:d=>a(d)}),e.jsx(oe,{open:v,onClose:T,title:u,children:e.jsx(he,{initialValues:j,onSubmit:N,onClose:T})})]})}export{Ze as default};
//# sourceMappingURL=Parent.page-D9V1HsCF.js.map
